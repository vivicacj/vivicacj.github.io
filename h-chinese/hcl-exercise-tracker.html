<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O水准高级华文练习平台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --text-on-dark: rgba(255, 255, 255, 0.95);
            --card-background: rgba(255, 255, 255, 0.98);
            --text-color: #34495e;
            --text-light: #7f8c8d;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            padding-top: 90px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
        }

        .header {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            text-shadow: 1px 1px 5px rgba(0,0,0,0.2);
        }
        
        .main-content { padding: 40px 0; }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .section-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-on-dark);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .action-buttons { display: flex; gap: 10px; }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .btn-primary:hover { background-color: #f8f9fa; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: var(--text-on-dark);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: #f1f3f5;
            border-radius: 8px;
            padding: 8px 12px;
            min-width: 250px;
        }
        
        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 14px;
            background: transparent;
        }
        
        .filter-tabs { display: flex; gap: 8px; }
        
        .filter-tab {
            padding: 8px 16px;
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-light);
        }
        
        .filter-tab.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .practice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
        }
        
        .practice-card {
            background: var(--card-background);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
            overflow: visible; /* Changed to allow menu overflow */
            position: relative; /* Added for menu positioning */
        }
        .practice-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-lg); }
        
        .card-header {
            padding: 20px;
            color: white;
            position: relative;
            border-radius: 16px 16px 0 0;
        }
        .card-header-practical-writing { background: linear-gradient(135deg, #2b8a3e, #51cf66); }
        .card-header-composition { background: linear-gradient(135deg, #e8590c, #fd7e14); }
        .card-header-language-application { background: linear-gradient(135deg, #c92a2a, #fa5252); }
        .card-header-reading-1 { background: linear-gradient(135deg, #1971c2, #339af0); }
        .card-header-reading-2 { background: linear-gradient(135deg, #0b7285, #15aabf); }
        .card-header-summary { background: linear-gradient(135deg, #a61e4d, #f06595); }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .card-meta { font-size: 0.85rem; opacity: 0.9; }
        
        .card-content { padding: 25px; }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .info-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        .info-label { font-size: 0.8rem; color: var(--text-light); }
        .info-value { font-weight: 500; }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            color: white;
        }
        .status-completed { background-color: #28a745; }
        .status-pending { background-color: #fd7e14; }
        .status-new { background-color: #1c7ed6; }

        .difficulty-badge {
            font-weight: 500;
        }
        .difficulty-beginner { color: #28a745; }
        .difficulty-intermediate { color: #fd7e14; }
        .difficulty-advanced { color: #c92a2a; }
        
        /* --- Action Menu Styles --- */
        .card-actions-menu {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card-actions-menu:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        .card-menu {
            display: none;
            position: absolute;
            top: 55px;
            right: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            z-index: 10;
            overflow: hidden;
            animation: fadeInMenu 0.2s ease-out;
        }
        .card-menu.show { display: block; }
        @keyframes fadeInMenu { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .card-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-color);
        }
        .card-menu-item:hover {
            background-color: #f1f3f5;
        }
        .card-menu-item.delete { color: #e74c3c; }

        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); z-index: 1000;
            align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 16px; width: 90%;
            max-width: 500px; box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            max-height: 90vh; overflow-y: auto;
        }
        .modal-header { font-size: 1.5rem; font-weight: 700; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-input, .form-select {
            width: 100%; padding: 12px; border: 1px solid #ced4da;
            border-radius: 8px; font-size: 1rem; transition: all 0.2s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        .form-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px; }
        
        #batchUploadModal .modal-content { max-width: 700px; }
        .upload-tab-nav { display: flex; gap: 10px; margin-bottom: 20px; }
        .upload-tab { display: none; }
        .upload-tab.active { display: block; }
        
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">✍️ 高级华文・练习中枢</div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openPracticeModal()">➕ 添加练习</button>
                    <button class="btn btn-secondary" onclick="openBatchUploadModal()">📁 批量上传</button>
                    <button class="btn btn-secondary" onclick="exportProgress()">📊 导出进度</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="content-header">
                <h1 class="section-title" id="sectionTitle">专项考题一：实用文</h1>
                <select class="form-input" id="sectionSelect" onchange="changeSection()" style="max-width: 250px;">
                    <option value="practical-writing">专项考题一：实用文</option>
                    <option value="composition">专项考题二：作文</option>
                    <option value="language-application">专项考题三：语文应用</option>
                    <option value="reading-1">专项考题四：阅读理解一</option>
                    <option value="reading-2">专项考题五：阅读理解二</option>
                    <option value="summary">专项考题六：片段缩写</option>
                </select>
            </div>

            <div class="toolbar">
                <div class="search-box">
                    <span>🔍</span>
                    <input type="text" placeholder="按名称搜索..." id="searchInput">
                </div>
                <div class="filter-tabs">
                    <button class="filter-tab active" data-filter="all">全部</button>
                    <button class="filter-tab" data-filter="completed">已完成</button>
                    <button class="filter-tab" data-filter="pending">进行中</button>
                    <button class="filter-tab" data-filter="new">新题目</button>
                </div>
            </div>

            <div class="practice-grid" id="practiceGrid"></div>
        </div>
    </main>

    <div class="modal" id="practiceModal">
        <div class="modal-content">
             <div class="modal-header" id="modalTitle">添加新练习</div>
             <form id="practiceForm">
                <div class="form-group">
                    <label class="form-label" for="practiceName">练习名称 *</label>
                    <input type="text" class="form-input" id="practiceName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="practiceType">练习类型</label>
                    <select class="form-select" id="practiceType"></select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="googleDocLink">Google Docs 链接 *</label>
                    <input type="url" class="form-input" id="googleDocLink" required>
                </div>
                 <div class="form-group">
                    <label class="form-label" for="practiceStatus">状态</label>
                    <select class="form-select" id="practiceStatus">
                        <option value="new">新题目</option>
                        <option value="pending">进行中</option>
                        <option value="completed">已完成</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="difficultyLevel">难度等级</label>
                    <select class="form-select" id="difficultyLevel">
                        <option value="beginner">初级</option>
                        <option value="intermediate">中级</option>
                        <option value="advanced">高级</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="estimatedTime">预计时间 (分钟)</label>
                    <input type="number" class="form-input" id="estimatedTime" min="5">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closePracticeModal()">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
             </form>
        </div>
    </div>
    <div class="modal" id="batchUploadModal">
        <div class="modal-content">
            <div class="modal-header">批量上传练习</div>
             <div class="upload-tab-nav">
                <button class="btn btn-primary" id="manualTabBtn" onclick="switchUploadTab('manual')">手动输入</button>
                <button class="btn btn-secondary" id="templateTabBtn" onclick="switchUploadTab('template')">使用模板</button>
            </div>
            <div id="manualUploadTab" class="upload-tab active">
                <p style="color: #666; margin-bottom: 15px;">每行一个练习, 格式: 名称 | 链接 | 难度 | 时间</p>
                <textarea class="form-input" id="batchPracticeInput" rows="8" placeholder="私人电邮：邀请朋友 | https://... | beginner | 30"></textarea>
            </div>
            <div id="templateUploadTab" class="upload-tab">
                <a href="javascript:void(0)" onclick="downloadCSVTemplate()" class="btn btn-secondary" style="margin-bottom: 15px;">📥 下载CSV模板</a>
                <input type="file" class="form-input" id="csvFileUpload" accept=".csv">
            </div>
             <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeBatchUploadModal()">取消</button>
                <button type="button" class="btn btn-primary" onclick="processBatchUpload()">上传</button>
            </div>
        </div>
    </div>

    <script>
        // Data and State Management
        const sectionTypes = {
            'practical-writing': ['私人电邮', '公务电邮', '博客', '网页', '论坛'],
            'composition': ['记叙文', '论说文', '演讲词', '新闻/材料读后感'],
            'language-application': ['A.短文填空', 'B.病句修改'],
            'reading-1': ['阅读理解一'],
            'reading-2': ['阅读理解二'],
            'summary': ['片段缩写']
        };

        let practicesData = {
            'practical-writing': [{ id: 1, name: '私人电邮：邀请朋友', type: '私人电邮', status: 'completed', difficulty: 'beginner', estimatedTime: 30, googleDocLink: '#', dateAdded: '2024-03-15', completedDate: '2024-03-20' }],
            'composition': [{ id: 11, name: '记叙文：难忘的一天', type: '记叙文', status: 'new', difficulty: 'intermediate', estimatedTime: 90, googleDocLink: '#', dateAdded: '2024-09-20' }],
            'language-application': [{ id: 31, name: '病句修改练习（一）', type: 'B.病句修改', status: 'new', difficulty: 'intermediate', estimatedTime: 25, googleDocLink: '#', dateAdded: '2024-09-28' }],
            'reading-1': [{ id: 21, name: '2023年真题练习', type: '阅读理解一', status: 'pending', difficulty: 'intermediate', estimatedTime: 50, googleDocLink: '#', dateAdded: '2024-09-25' }],
            'reading-2': [],
            'summary': []
        };

        let currentSection = 'practical-writing';
        let currentFilter = 'all';
        const practiceGrid = document.getElementById('practiceGrid');
        const searchInput = document.getElementById('searchInput');
        const practiceModal = document.getElementById('practiceModal');
        const batchUploadModal = document.getElementById('batchUploadModal');
        const practiceForm = document.getElementById('practiceForm');
        const modalTitle = document.getElementById('modalTitle');
        const sectionTitle = document.getElementById('sectionTitle');
        const sectionSelect = document.getElementById('sectionSelect');
        const practiceTypeSelect = document.getElementById('practiceType');

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            renderPractices();
            setupEventListeners();
        });

        // Event Listeners Setup
        function setupEventListeners() {
            searchInput.addEventListener('input', renderPractices);

            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', e => {
                    document.querySelector('.filter-tab.active').classList.remove('active');
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.filter;
                    renderPractices();
                });
            });

            practiceForm.addEventListener('submit', handleFormSubmit);
            practiceModal.addEventListener('click', (e) => { if (e.target === practiceModal) closePracticeModal(); });
            batchUploadModal.addEventListener('click', (e) => { if (e.target === batchUploadModal) closeBatchUploadModal(); });

            practiceGrid.addEventListener('click', e => {
                const menuButton = e.target.closest('.card-actions-menu');
                if (menuButton) {
                    const currentMenu = menuButton.nextElementSibling;
                    const isVisible = currentMenu.classList.contains('show');
                    
                    document.querySelectorAll('.card-menu.show').forEach(menu => {
                        menu.classList.remove('show');
                    });
                    
                    if (!isVisible) {
                        currentMenu.classList.add('show');
                    }
                }
            });
            window.addEventListener('click', e => {
                if (!e.target.closest('.practice-card')) {
                    document.querySelectorAll('.card-menu.show').forEach(menu => menu.classList.remove('show'));
                }
            });
        }
        
        // Rendering Logic
        function renderPractices() {
            const filteredData = getFilteredData();
            practiceGrid.innerHTML = '';
            if (filteredData.length === 0) {
                practiceGrid.innerHTML = '<p style="color: #7b8b9a; text-align: center; grid-column: 1 / -1; font-size: 1.1rem; padding: 50px 0;">该分类下没有练习。</p>';
                return;
            }
            filteredData.forEach(practice => {
                practiceGrid.appendChild(createPracticeCard(practice));
            });
        }
        
        function getFilteredData() {
            const searchTerm = searchInput.value.toLowerCase();
            let practices = practicesData[currentSection] || [];
            if (currentFilter !== 'all') {
                practices = practices.filter(p => p.status === currentFilter);
            }
            if (searchTerm) {
                practices = practices.filter(p => p.name.toLowerCase().includes(searchTerm));
            }
            return practices.sort((a, b) => new Date(b.dateAdded) - new Date(a.dateAdded));
        }

        function createPracticeCard(practice) {
            const card = document.createElement('div');
            card.className = 'practice-card';
            card.dataset.id = practice.id;

            const sectionKey = currentSection;
            const headerClass = `card-header-${sectionKey}`;

            card.innerHTML = `
                <div class="card-header ${headerClass}">
                    <h3 class="card-title">${practice.name}</h3>
                    <p class="card-meta">${practice.type}</p>
                    <button class="card-actions-menu">⋮</button>
                    <div class="card-menu">
                        <button class="card-menu-item edit" onclick="openPracticeModal(${practice.id})">✏️ 编辑</button>
                        <button class="card-menu-item delete" onclick="deletePractice(${practice.id})">🗑️ 删除</button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">状态</div>
                            <div class="info-value"><span class="status-badge status-${practice.status}">${getStatusText(practice.status)}</span></div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">难度</div>
                            <div class="info-value difficulty-badge difficulty-${practice.difficulty}">${getDifficultyText(practice.difficulty)}</div>
                        </div>
                        <div class="info-item">
                             <div class="info-label">添加日期</div>
                             <div class="info-value">${practice.dateAdded}</div>
                        </div>
                        <div class="info-item">
                             <div class="info-label">预计时间</div>
                             <div class="info-value">${practice.estimatedTime} 分钟</div>
                        </div>
                    </div>
                    <a href="${practice.googleDocLink}" target="_blank" class="btn btn-primary" style="width: 100%;">开始练习</a>
                </div>
            `;
            return card;
        }
        
        // UI and Data Actions
        function changeSection() {
            currentSection = sectionSelect.value;
            sectionTitle.textContent = sectionSelect.options[sectionSelect.selectedIndex].text;
            renderPractices();
        }

        function updatePracticeTypeOptions() {
            const types = sectionTypes[currentSection] || [];
            practiceTypeSelect.innerHTML = types.map(type => `<option value="${type}">${type}</option>`).join('');
        }

        function openPracticeModal(id = null) {
            practiceForm.reset();
            practiceForm.dataset.editingId = '';
            updatePracticeTypeOptions();

            if (id) {
                const practice = findPractice(id);
                if (practice) {
                    modalTitle.textContent = '编辑练习';
                    document.getElementById('practiceName').value = practice.name;
                    document.getElementById('practiceType').value = practice.type;
                    document.getElementById('googleDocLink').value = practice.googleDocLink;
                    document.getElementById('practiceStatus').value = practice.status;
                    document.getElementById('difficultyLevel').value = practice.difficulty;
                    document.getElementById('estimatedTime').value = practice.estimatedTime;
                    practiceForm.dataset.editingId = id;
                }
            } else {
                modalTitle.textContent = '添加新练习';
                document.getElementById('practiceStatus').value = 'new';
            }
            practiceModal.style.display = 'flex';
        }

        function deletePractice(id) {
            if (confirm('确定要删除这个练习吗？此操作无法撤销。')) {
                for (const sectionKey in practicesData) {
                    const index = practicesData[sectionKey].findIndex(p => p.id == id);
                    if (index > -1) {
                        practicesData[sectionKey].splice(index, 1);
                        break;
                    }
                }
                renderPractices();
            }
        }
        
        function closePracticeModal() { practiceModal.style.display = 'none'; }
        function openBatchUploadModal() { batchUploadModal.style.display = 'flex'; }
        function closeBatchUploadModal() { batchUploadModal.style.display = 'none'; }
        
        function handleFormSubmit(e) {
            e.preventDefault();
            const id = practiceForm.dataset.editingId;
            const formData = {
                name: document.getElementById('practiceName').value,
                type: document.getElementById('practiceType').value,
                googleDocLink: document.getElementById('googleDocLink').value,
                status: document.getElementById('practiceStatus').value,
                difficulty: document.getElementById('difficultyLevel').value,
                estimatedTime: parseInt(document.getElementById('estimatedTime').value) || 30,
            };

            if (id) {
                const index = practicesData[currentSection].findIndex(p => p.id == id);
                if (index !== -1) {
                    const existingPractice = practicesData[currentSection][index];
                    practicesData[currentSection][index] = { ...existingPractice, ...formData };
                }
            } else {
                const newPractice = { ...formData, id: Date.now(), dateAdded: new Date().toISOString().split('T')[0] };
                if (!practicesData[currentSection]) practicesData[currentSection] = [];
                practicesData[currentSection].push(newPractice);
            }
            renderPractices();
            closePracticeModal();
        }
        
        function findPractice(id) {
            for (const section in practicesData) {
                const practice = practicesData[section].find(p => p.id == id);
                if (practice) return practice;
            }
            return null;
        }
        
        function switchUploadTab(tabName) {
            document.querySelectorAll('.upload-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.upload-tab-nav .btn').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            document.getElementById(`${tabName}UploadTab`).classList.add('active');
            document.getElementById(`${tabName}TabBtn`).classList.add('btn-primary');
        }

        function processBatchUpload() {
            const input = document.getElementById('batchPracticeInput').value.trim();
            if(!input) return alert('请输入练习信息');

            const lines = input.split('\n').filter(line => line.trim());
            const newPractices = lines.map((line, index) => {
                 const parts = line.split('|').map(p => p.trim());
                 if (parts.length < 2) return null;
                 return {
                    id: Date.now() + index, name: parts[0], googleDocLink: parts[1],
                    type: sectionTypes[currentSection]?.[0] || '练习',
                    difficulty: parts[2] || 'intermediate',
                    estimatedTime: parseInt(parts[3]) || 30,
                    status: 'new', dateAdded: new Date().toISOString().split('T')[0]
                 };
            }).filter(p => p);

            if (!practicesData[currentSection]) practicesData[currentSection] = [];
            practicesData[currentSection].push(...newPractices);
            renderPractices();
            closeBatchUploadModal();
            alert(`成功批量添加 ${newPractices.length} 个练习！`);
        }
        
        function downloadCSVTemplate() {
             const headers = "练习名称,类型,Google Docs链接,难度,预计时间(分钟)";
             const example = "记叙文：我的爱好,记叙文,https://docs.google.com/document/d/...,intermediate,90";
             const csvContent = "data:text/csv;charset=utf-8,\uFEFF" + headers + "\n" + example;
             const encodedUri = encodeURI(csvContent);
             const link = document.createElement("a");
             link.setAttribute("href", encodedUri);
             link.setAttribute("download", "华文练习导入模板.csv");
             document.body.appendChild(link);
             link.click();
             document.body.removeChild(link);
        }

        function exportProgress() {
            const allPractices = Object.values(practicesData).flat();
            if(allPractices.length === 0) return alert('没有进度可以导出。');

            let content = `O水准高级华文练习进度报告\n==========================\n\n`;
            
            Object.keys(sectionTypes).forEach(sectionKey => {
                const sectionName = sectionSelect.querySelector(`option[value="${sectionKey}"]`).textContent;
                content += `${sectionName}\n----------------\n`;
                const sectionPractices = practicesData[sectionKey] || [];
                if (sectionPractices.length > 0) {
                    sectionPractices.forEach(p => {
                        content += `- [${p.status === 'completed' ? 'x' : ' '}] ${p.name} (${p.type})\n`;
                    });
                } else {
                    content += "暂无练习\n";
                }
                content += "\n";
            });
            
             const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
             const url = URL.createObjectURL(blob);
             const link = document.createElement("a");
             link.setAttribute("href", url);
             link.setAttribute("download", `华文练习进度报告_${new Date().toISOString().split('T')[0]}.txt`);
             document.body.appendChild(link);
             link.click();
             document.body.removeChild(link);
             alert("进度报告已导出为 TXT 文件。")
        }


        // --- HELPERS ---
        function getStatusText(status) { return { 'completed': '已完成', 'pending': '进行中', 'new': '新题目' }[status] || '未知'; }
        function getDifficultyText(difficulty) { return { 'beginner': '初级', 'intermediate': '中级', 'advanced': '高级' }[difficulty] || '中级'; }
    </script>
</body>
</html>
