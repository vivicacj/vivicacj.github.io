<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geography A1 Logic Engine V3.0 | Pro Edition</title>
    <style>
        :root {
            --bg-deep: #020617;
            --bg-card: #1e293b;
            --bg-input: #0f172a;
            --blue-prime: #38bdf8;
            --purple-prime: #818cf8;
            --green-prime: #10b981;
            --orange-prime: #fb923c;
            --text-high: #f8fafc;
            --text-low: #94a3b8;
            --border: #334155;
            --accent-glow: rgba(56, 189, 248, 0.15);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-high);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--border);
        }

        .version-badge {
            background: linear-gradient(90deg, var(--blue-prime), var(--purple-prime));
            color: var(--bg-deep);
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 1px;
        }

        h1 { font-size: 2.5rem; margin: 10px 0; font-weight: 900; background: linear-gradient(to bottom right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .top-nav {
            display: grid;
            grid-template-columns: 1fr 200px 180px;
            gap: 15px;
            margin-bottom: 30px;
        }

        select, button {
            padding: 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: white;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        select:focus { border-color: var(--blue-prime); box-shadow: 0 0 15px var(--accent-glow); outline: none; }
        
        .btn-mastery {
            background: rgba(16, 185, 129, 0.1);
            color: var(--green-prime);
            border: 1px solid var(--green-prime);
            font-weight: 600;
        }
        .btn-mastery.active { background: var(--green-prime); color: var(--bg-deep); }

        .main-grid {
            display: grid;
            grid-template-columns: 1.6fr 1fr;
            gap: 25px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: var(--bg-card);
            padding: 24px;
            border-radius: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-row {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--bg-input);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid transparent;
            transition: 0.3s;
        }
        .step-row:focus-within { border-color: var(--blue-prime); background: #1e293b; }

        .step-num {
            width: 28px;
            height: 28px;
            background: var(--blue-prime);
            color: var(--bg-deep);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.8rem;
        }

        .step-row input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 1rem;
        }
        .step-row input:focus { outline: none; }

        .fuel-tags { display: flex; flex-wrap: wrap; gap: 10px; }
        .tag {
            background: #0f172a;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-low);
            border: 1px solid var(--border);
            transition: 0.3s;
        }
        .tag.active {
            background: var(--blue-prime);
            color: var(--bg-deep);
            border-color: var(--blue-prime);
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.4);
            transform: scale(1.05);
        }

        /* LORS Evaluation Layout Upgrade */
        .lors-box { border: 2px solid rgba(16, 185, 129, 0.3); }
        .eval-section { margin-bottom: 20px; }
        .eval-label { 
            font-size: 0.8rem; 
            font-weight: 800; 
            color: var(--green-prime); 
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .eval-label::after { content: ""; height: 1px; flex: 1; background: rgba(16, 185, 129, 0.2); }

        textarea {
            width: 100%;
            background: var(--bg-input);
            color: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 15px;
            resize: vertical;
            min-height: 100px;
            font-size: 0.95rem;
            transition: 0.3s;
            box-sizing: border-box;
        }
        textarea:focus { border-color: var(--green-prime); outline: none; background: #1e293b; box-shadow: 0 0 10px rgba(16, 185, 129, 0.1); }

        .audit-panel {
            display: none;
            background: #064e3b;
            padding: 30px;
            border-radius: 24px;
            margin-top: 30px;
            border: 2px solid var(--green-prime);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            scroll-margin-top: 20px;
        }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; background: var(--text-low); }
        .status-dot.saved { background: var(--green-prime); box-shadow: 0 0 5px var(--green-prime); }
        
        @media (max-width: 850px) {
            .main-grid { grid-template-columns: 1fr; }
            .top-nav { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <span class="version-badge">V3.0 FULL-DATA EDITION</span>
        <h1>Geography Logic Engine</h1>
        <div id="saveStatus" style="font-size: 0.75rem; color: var(--text-low);"><span class="status-dot"></span> System Ready</div>
    </header>

    <div class="top-nav">
        <select id="topicSelect" onchange="runEngine()">
            <option value="">-- SELECT TOPIC --</option>
        </select>
        <button id="masteryBtn" onclick="toggleMastery()" class="btn-mastery">MARK MASTERED</button>
        <button onclick="toggleAudit()" style="background: var(--purple-prime); color: white; font-weight: bold; border:none;">MIRROR AUDIT</button>
    </div>

    <div class="main-grid" id="mainEngine" style="display: none;">
        <div class="left-col">
            <div class="card">
                <div class="router-header">
                    <div class="card-title">
                        <span>üöÄ</span> 
                        <span id="topicTitle">Topic</span>
                    </div>
                    <span id="routerType" style="background:var(--blue-prime); color:var(--bg-deep); padding:4px 12px; border-radius:8px; font-weight:800; font-size:0.75rem;">TYPE</span>
                </div>
                <div id="logicChain"></div>
            </div>

            <!-- Module 5 Layout Upgraded -->
            <div class="card lors-box">
                <div class="card-title" style="color:var(--green-prime);">‚öñÔ∏è Module 5: LORS Evaluation</div>
                <div id="lorsQuestion" style="font-size:0.95rem; margin-bottom:25px; font-style:italic; color: var(--text-low); border-left: 2px solid var(--green-prime); padding-left: 15px;">Question Prompt</div>
                
                <div class="eval-section">
                    <div class="eval-label">Perspective A: Positive / Short-term / Local</div>
                    <textarea id="lorsA" oninput="autoSave()" placeholder="Develop argument A with evidence..."></textarea>
                </div>

                <div class="eval-section">
                    <div class="eval-label">Perspective B: Negative / Long-term / Global</div>
                    <textarea id="lorsB" oninput="autoSave()" placeholder="Develop argument B with evidence..."></textarea>
                </div>

                <div class="eval-section" style="margin-bottom: 0;">
                    <div class="eval-label" style="color: var(--blue-prime);">Weighted Conclusion (To what extent?)</div>
                    <textarea id="lorsVerdict" oninput="autoSave()" style="min-height: 80px; border-color: rgba(56, 189, 248, 0.3);" placeholder="Final synthesis and weighted judgment..."></textarea>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="card">
                <div class="card-title" style="color:var(--blue-prime);">‚ö° Module 2: Fuel Scanner</div>
                <div class="fuel-tags" id="fuelTags"></div>
            </div>

            <div class="card" style="border-color: var(--orange-prime);">
                <div class="card-title" style="color:var(--orange-prime);">üîç Module 3: Visual Fingerprints</div>
                <div id="visualList"></div>
            </div>

            <div class="card" style="border-color: var(--purple-prime);">
                <div class="card-title" style="color:var(--purple-prime);">üìÇ Module 4: Case Vault</div>
                <div class="vault-grid" id="vaultGrid"></div>
            </div>
        </div>
    </div>

    <div class="audit-panel" id="auditPanel">
        <h3 style="margin-top:0; color:var(--green-prime);">A1 Standard Logic Benchmarking:</h3>
        <div id="auditContent" style="white-space: pre-line; padding: 10px 0;"></div>
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" style="margin-top: 20px; width: auto; padding: 10px 20px; font-size: 0.8rem; background: rgba(255,255,255,0.1); border:none; color:white; cursor:pointer; border-radius:8px;">Back to Top</button>
    </div>
</div>

<script id="geo-data">
    const rawGeoData = {
      "Tectonic_Hazards": {
        "Volcano_Formation": {
          "type": "Explain (Sequence)",
          "logic": ["Magma rises via fractures", "Accumulation in magma chamber", "Eruption through vent", "Solidification in layers"],
          "fuel": ["Magma Chamber", "Viscosity", "Solidification", "Vent"],
          "visuals": ["Conical Shape", "Crater", "Alternate Layers"],
          "lors": "Evaluate the effectiveness of monitoring in volcanic areas.",
          "cases": ["Mt. Pinatubo (1991)"]
        },
        "Earthquake_Mechanism": {
          "type": "Explain (Energy)",
          "logic": ["Plates move/stuck (Friction)", "Stress builds on fault", "Sudden energy release", "Seismic waves radiate"],
          "fuel": ["Friction", "Stress", "Epicenter", "Seismic Waves"],
          "visuals": ["Fault Line", "Radiating Waves"],
          "lors": "Is building design more important than education in earthquakes?",
          "cases": ["Tohoku (2011)", "Haiti (2010)"]
        }
      },
      "Weather_and_Climate": {
        "Convectional_Rain": {
          "type": "Explain (Process)",
          "logic": ["Solar radiation heats ground", "Air expands and rises", "Adiabatic cooling", "Condensation"],
          "fuel": ["Solar Radiation", "Convection", "Adiabatic Cooling", "Dew Point"],
          "visuals": ["Anvil Cloud", "Cumulonimbus"],
          "lors": "Assess the impact of convectional rain on urban flash floods.",
          "cases": ["Singapore (2021)"]
        },
        "Climate_Change": {
          "type": "Evaluate (Impact)",
          "logic": ["GHGs trap heat", "Rising temperatures", "Melting ice caps", "Sea level rise"],
          "fuel": ["Greenhouse Effect", "Anthropogenic", "Short-wave", "Long-wave"],
          "visuals": ["Heat Trapping Diagram"],
          "lors": "How far are international agreements successful in curbing warming?",
          "cases": ["Kiribati", "Paris Agreement"]
        },
        "Temperature_Variations": {
          "type": "Explain (Spatial Variations)",
          "logic": [
            "Latitude: Higher solar angle at equator leads to more intense heating.",
            "Altitude: Air becomes less dense at height, absorbing less long-wave radiation.",
            "Distance from Sea: Maritime effect regulates coastal temps via sea breezes.",
            "Cloud Cover: Reflects short-wave by day and traps long-wave by night."
          ],
          "fuel": ["Angle of Incidence", "Maritime Effect", "Continental Effect", "Specific Heat Capacity"],
          "visuals": [
            "Latitude: High Angle of Incidence (concentrated) vs Oblique Angle (spread out).", 
            "Altitude: Temperature Gradient (-6.5¬∞C/km); less dense air traps less heat.",
            "Maritime vs Continental: Flat temp curve (coastal) vs SteepËµ∑‰ºè (inland) due to SHC."
          ],
          "lors": "Explain why inland areas have a higher annual temperature range than coastal areas.",
          "cases": ["Singapore (Coastal) vs Beijing (Inland)"]
        },
        "Relief_Rain": {
          "type": "Explain (Topographic Process)",
          "logic": [
            "Moist air is forced to rise over a physical barrier (mountain).",
            "Rising air cools adiabatically to its dew point temperature.",
            "Condensation occurs on the windward side, forming clouds and rain.",
            "Dry air descends on the leeward side, creating a rainshadow."
          ],
          "fuel": ["Windward Side", "Leeward Side", "Rainshadow Effect", "Adiabatic Cooling"],
          "visuals": [
            "Windward vs Leeward: Moist air ascent vs Dry air descent (distinct contrast).",
            "Condensation Level: Cloud base height where air cools to dew point.",
            "Rainshadow Area: Distinct clear sky on leeward side of the barrier."
          ],
          "lors": "Assess the role of relief in influencing the distribution of rainfall.",
          "cases": ["Himalayas (India)", "Great Dividing Range (Australia)"]
        },
        "Land_and_Sea_Breezes": {
          "type": "Explain (Diurnal Pressure Gradient)",
          "logic": [
            "During day, land heats faster than sea due to specific heat capacity.",
            "Air over land rises, creating a low-pressure zone.",
            "Cooler, denser air from the sea moves towards land (Sea Breeze).",
            "At night, land cools faster, reversing the pressure gradient (Land Breeze)."
          ],
          "fuel": ["Specific Heat Capacity", "Pressure Gradient", "Convection", "Diurnal Change"],
          "visuals": ["High/Low Pressure Cells", "Day vs Night Circulation"],
          "lors": "Explain how differential heating leads to the formation of local winds.",
          "cases": ["Coastal Singapore (Daily sea breezes)"]
        }
      },
      "Tourism": {
        "Sustainable_Tourism": {
          "type": "Evaluate (Strategic)",
          "logic": ["Economic gain vs Environmental loss", "Stakeholder involvement", "Conservation laws", "Education/Ecotourism"],
          "fuel": ["Carrying Capacity", "Stakeholders", "Fragile Environments", "Leakage"],
          "visuals": ["Butler Model", "Degradation"],
          "lors": "To what extent can stakeholders achieve sustainable tourism?",
          "cases": ["Rwanda", "Venice", "Bali"]
        }
      },
      "Food_Resources": {
        "Green_Revolution": {
          "type": "Explain (Innovation)",
          "logic": ["Introduction of HYVs", "Chemical fertilizers/Pesticides", "Mechanization", "Irrigation expansion"],
          "fuel": ["HYVs", "Eutrophication", "Mechanization", "Food Security"],
          "visuals": ["Yield Gap Charts"],
          "lors": "How successful was the Green Revolution in ensuring food security?",
          "cases": ["India (Punjab)"]
        }
      },
      "Coasts": {
        "Cliff_Retreat": {
          "type": "Explain (Erosion)",
          "logic": ["Wave attack at base", "Notch formation", "Overhang collapses", "Cliff retreats inland"],
          "fuel": ["Hydraulic Action", "Abrasion", "Wave-cut Platform", "Notch"],
          "visuals": ["Notch Profile", "Wave-cut Platform"],
          "lors": "Assess the success of hard engineering in protecting coastlines.",
          "cases": ["Holderness Coast"]
        }
      }
    };

    const caseVault = {
        "Mt. Pinatubo (1991)": "0.5¬∞C Global Cooling, Lahars, 20m tons SO2",
        "Tohoku (2011)": "9.0 Mag, 10m Tsunami, $300bn loss, Nuclear Meltdown",
        "Haiti (2010)": "7.0 Mag, 230k deaths, 1.5m homeless, Cholera outbreak",
        "Kiribati": "1.2cm rise/year, Saltwater intrusion, 'Migration with Dignity'",
        "Singapore (2021)": "Intense flash floods, 90% of monthly rain in 3 hours",
        "Singapore (Coastal) vs Beijing (Inland)": "Beijing range ~30¬∞C vs SG ~2¬∞C due to maritime vs continental effects.",
        "Himalayas (India)": "Heavy relief rain on windward (Cherrapunji) vs dry Tibetan Plateau (Rainshadow).",
        "Great Dividing Range (Australia)": "Moist winds from Pacific bring rain to East Coast; interior remains arid.",
        "Coastal Singapore (Daily sea breezes)": "Thermal heating of island creates localized low pressure, drawing sea air.",
        "India (Punjab)": "HYVs doubled wheat production, but caused water table drop",
        "Bali": "Tourism diverts 65% of water from agriculture/local use",
        "Venice": "Tourism exceeds carrying capacity, causing high local living costs",
        "Holderness Coast": "Fastest eroding coastline in Europe, 2m/year retreat",
        "Paris Agreement": "Global goal to limit warming to well below 2¬∞C",
        "Rwanda": "High-end gorilla trekking ecotourism, supporting conservation"
    };
</script>

<script id="engine-logic">
    let flatTopics = {}; 
    let currentTopic = "";

    window.onload = function() {
        initData();
        renderTopicMenu();
    };

    function initData() {
        for (const category in rawGeoData) {
            for (const topic in rawGeoData[category]) {
                flatTopics[topic] = rawGeoData[category][topic];
            }
        }
    }

    function renderTopicMenu() {
        const select = document.getElementById('topicSelect');
        select.innerHTML = '<option value="">-- SELECT TOPIC --</option>';
        for (const category in rawGeoData) {
            const group = document.createElement('optgroup');
            group.label = category.replace(/_/g, ' ');
            for (const topic in rawGeoData[category]) {
                const opt = document.createElement('option');
                opt.value = topic;
                opt.textContent = topic.replace(/_/g, ' ');
                group.appendChild(opt);
            }
            select.appendChild(group);
        }
    }

    function runEngine() {
        currentTopic = document.getElementById('topicSelect').value;
        if (!currentTopic) {
            document.getElementById('mainEngine').style.display = 'none';
            return;
        }
        
        const data = flatTopics[currentTopic];
        document.getElementById('mainEngine').style.display = 'grid';
        document.getElementById('topicTitle').innerText = currentTopic.replace(/_/g, ' ');
        document.getElementById('routerType').innerText = data.type;
        document.getElementById('lorsQuestion').innerText = "Prompt: " + data.lors;

        const chain = document.getElementById('logicChain');
        chain.innerHTML = data.logic.map((_, i) => `
            <div class="step-row">
                <div class="step-num">${i+1}</div>
                <input type="text" id="step-${i}" oninput="scanKeywords()" placeholder="Enter logical deduction...">
            </div>
        `).join('');

        document.getElementById('fuelTags').innerHTML = data.fuel.map(f => `<span class="tag" id="tag-${f.replace(/\s/g, '')}">${f}</span>`).join('');
        document.getElementById('visualList').innerHTML = data.visuals.map(v => `<div class="fingerprint-item" style="border-top: 1px solid var(--border); padding: 10px 0; font-size:0.9rem;">‚Ä¢ ${v}</div>`).join('');
        document.getElementById('vaultGrid').innerHTML = data.cases.map(c => `
            <div class="case-mini-card" style="background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; margin-bottom:10px; border-left:3px solid var(--purple-prime);">
                <strong>${c}</strong><br>
                <small>${caseVault[c] || 'Description pending...'}</small>
            </div>`).join('');

        document.getElementById('auditContent').innerHTML = data.logic.map((l, i) => `‚Ä¢ Step ${i+1}: ${l}`).join('\n');
        document.getElementById('auditPanel').style.display = 'none';

        loadState();
        scanKeywords();
        updateMasteryUI();
    }

    function scanKeywords() {
        if (!currentTopic) return;
        const data = flatTopics[currentTopic];
        const allText = Array.from(document.querySelectorAll('.step-row input')).map(i => i.value.toLowerCase()).join(' ');
        data.fuel.forEach(f => {
            const tagId = `tag-${f.replace(/\s/g, '')}`;
            const tag = document.getElementById(tagId);
            if (tag) {
                if (allText.includes(f.toLowerCase())) tag.classList.add('active');
                else tag.classList.remove('active');
            }
        });
        autoSave();
    }

    function autoSave() {
        if (!currentTopic) return;
        const state = {
            steps: Array.from(document.querySelectorAll('.step-row input')).map(i => i.value),
            lorsA: document.getElementById('lorsA').value,
            lorsB: document.getElementById('lorsB').value,
            verdict: document.getElementById('lorsVerdict').value
        };
        localStorage.setItem(`geo_v3_${currentTopic}`, JSON.stringify(state));
    }

    function loadState() {
        const saved = localStorage.getItem(`geo_v3_${currentTopic}`);
        if (!saved) return;
        const state = JSON.parse(saved);
        state.steps.forEach((val, i) => {
            if (document.getElementById(`step-${i}`)) document.getElementById(`step-${i}`).value = val;
        });
        document.getElementById('lorsA').value = state.lorsA || "";
        document.getElementById('lorsB').value = state.lorsB || "";
        document.getElementById('lorsVerdict').value = state.verdict || "";
    }

    function toggleMastery() {
        if (!currentTopic) return;
        const key = `geo_v3_mastery_${currentTopic}`;
        const isMastered = localStorage.getItem(key) === 'true';
        localStorage.setItem(key, !isMastered);
        updateMasteryUI();
    }

    function updateMasteryUI() {
        if (!currentTopic) return;
        const key = `geo_v3_mastery_${currentTopic}`;
        const btn = document.getElementById('masteryBtn');
        if (localStorage.getItem(key) === 'true') {
            btn.classList.add('active');
            btn.innerText = "‚òÖ MASTERED";
        } else {
            btn.classList.remove('active');
            btn.innerText = "MARK MASTERED";
        }
    }

    function toggleAudit() {
        const p = document.getElementById('auditPanel');
        if (p.style.display === 'block') p.style.display = 'none';
        else {
            p.style.display = 'block';
            p.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
</script>
</body>
</html>
