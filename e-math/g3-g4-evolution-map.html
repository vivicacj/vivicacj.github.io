<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>G3→G4 Evolution Map · Hierarchical View</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap');
    
    * {
      font-family: 'Plus Jakarta Sans', sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --secondary: #8b5cf6;
      --accent: #06b6d4;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --glass: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow-x: hidden;
      position: relative;
    }

    /* Animated gradient background */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(6, 182, 212, 0.1) 0%, transparent 50%);
      animation: gradientShift 15s ease infinite;
      z-index: -1;
    }

    @keyframes gradientShift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .icon {
        width: 1em;
        height: 1em;
        display: inline-block;
        vertical-align: middle;
    }

    .glass {
      background: var(--glass);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .navbar {
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 1rem 2rem;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s ease-in-out infinite;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    @keyframes shimmer {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    .hero {
      padding: 4rem 2rem;
      text-align: center;
      position: relative;
    }

    .hero-title {
      font-size: clamp(2.5rem, 5vw, 4rem);
      font-weight: 800;
      line-height: 1.1;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: fadeInUp 0.8s ease-out;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      max-width: 800px;
      margin: 0 auto 2rem;
      animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      max-width: 900px;
      margin: 0 auto 3rem;
      animation: fadeInUp 1.2s ease-out;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.02));
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      padding: 2rem 1.5rem;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1));
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    .stat-card:hover::before {
      transform: translateX(100%);
    }

    .stat-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: var(--primary);
      box-shadow: 0 20px 60px rgba(99, 102, 241, 0.3);
    }

    .stat-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      display: inline-block;
      animation: float 3s ease-in-out infinite;
      color: var(--accent);
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 0.5rem;
    }

    .control-panel {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 3rem;
      animation: fadeInUp 1.4s ease-out;
    }

    .btn {
      padding: 0.875rem 1.75rem;
      border-radius: 1rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.5);
    }

    .btn-secondary {
      background: var(--glass);
      color: var(--text-primary);
      border: 1px solid var(--glass-border);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--primary);
    }
    
    .btn .icon {
        width: 1.2em;
        height: 1.2em;
    }

    .search-container {
      max-width: 750px;
      margin: 0 auto 3rem;
      position: relative;
      animation: fadeInUp 1.6s ease-out;
      width: 100%;
    }

    .search-box {
      width: 100%;
      padding: 1rem 3.5rem 1rem 3.5rem;
      border-radius: 1.5rem;
      border: 2px solid var(--glass-border);
      background: var(--glass);
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }

    .search-box:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
      background: rgba(255, 255, 255, 0.08);
    }

    .search-icon {
      position: absolute;
      left: 1.25rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.25rem;
      color: var(--text-secondary);
      pointer-events: none;
    }

    .search-clear {
      position: absolute;
      right: 1.25rem;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--text-secondary);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .search-box:not(:placeholder-shown) + .search-clear {
      opacity: 1;
      pointer-events: all;
    }
    
    .section {
      max-width: 1400px;
      margin: 0 auto;
      padding: 3rem 2rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .section-title {
      font-size: 2rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .section-title .icon {
        width: 1.5em;
        height: 1.5em;
        color: var(--primary);
    }
    
    #diagram .section-title {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    #diagram .section-title .icon {
        color: var(--primary); /* Keep icon color consistent */
    }


    .section-badge {
      padding: 0.5rem 1rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .badge-g3 {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
    }

    .badge-g4 {
      background: linear-gradient(135deg, #8b5cf6, #7c3aed);
      color: white;
    }

    .topic-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 2rem;
    }

    @media (max-width: 768px) {
      .topic-grid {
        grid-template-columns: 1fr;
      }
    }

    .topic-card {
      background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.02));
      border: 1px solid var(--glass-border);
      border-radius: 2rem;
      padding: 0;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .topic-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at var(--mouse-x, 50%) var(--mouse-y, 50%), rgba(255, 255, 255, 0.1), transparent 40%);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .topic-card:hover::after {
      opacity: 1;
    }

    .topic-card:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: var(--primary);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 60px rgba(99, 102, 241, 0.3);
    }
    
    /* === CODE FIX START === */
    .topic-card.expanded {
      overflow: visible; /* Allow content to flow out */
      z-index: 10;       /* Ensure it stacks on top of other elements */
    }
    /* === CODE FIX END === */

    .topic-card.card-core {
      border-left: 4px solid var(--primary);
    }

    .topic-card.card-satellite {
      border-left: 4px solid var(--success);
    }

    .topic-card.card-new {
      border-left: 4px solid var(--warning);
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(255, 255, 255, 0.02));
    }

    .topic-header {
      padding: 2rem;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .topic-title-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 1;
    }

    .topic-icon {
      font-size: 2rem;
      animation: float 3s ease-in-out infinite;
      color: var(--primary);
      flex-shrink: 0;
    }
    
    .topic-icon .icon {
        width: 1.5em;
        height: 1.5em;
    }


    .topic-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .topic-subtitle {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    .pill {
      padding: 0.375rem 0.875rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }

    .pill-core {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(99, 102, 241, 0.3));
      color: #a5b4fc;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .pill-satellite {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.3));
      color: #6ee7b7;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .pill-new {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.3));
      color: #fbbf24;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .evolution-badge {
      padding: 0.5rem 1rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .evolution-badge .icon {
        width: 1.2em;
        height: 1.2em;
    }

    .badge-deepening {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.3));
      color: #93c5fd;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .badge-extension {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.3));
      color: #c4b5fd;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }

    .badge-addition {
      background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.3));
      color: #fdba74;
      border: 1px solid rgba(249, 115, 22, 0.3);
    }

    .badge-meta {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.3));
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .expand-indicator {
      font-size: 1.5rem;
      transition: transform 0.3s;
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .expand-indicator .icon {
      width: 1.2em;
      height: 1.2em;
    }

    .topic-card.expanded .expand-indicator {
      transform: rotate(180deg);
    }

    .topic-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .topic-card.expanded .topic-content {
      max-height: none;
    }

    .topic-body {
      padding: 2rem;
    }

    .archetype-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.3s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .archetype-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .archetype-card.level-1 {
      border-left: 3px solid #3b82f6;
    }

    .archetype-card.level-2 {
      border-left: 3px solid #8b5cf6;
    }

    .archetype-card.level-3 {
      border-left: 3px solid #ef4444;
    }

    .archetype-title {
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .level-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .level-1 .level-badge {
      background: rgba(59, 130, 246, 0.2);
      color: #93c5fd;
    }

    .level-2 .level-badge {
      background: rgba(139, 92, 246, 0.2);
      color: #c4b5fd;
    }

    .level-3 .level-badge {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
    }

    .sop-chain {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--accent);
      line-height: 1.6;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 0.5rem;
      border-left: 3px solid var(--accent);
    }

    .catalog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
    }

    .catalog-card {
      background: linear-gradient(135deg, var(--glass), rgba(255, 255, 255, 0.02));
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      padding: 2rem;
      transition: all 0.3s;
    }

    .catalog-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }
    .catalog-card .archetype-list li {
        font-size: 1rem;
        padding: 0.75rem 0;
        color: var(--text-secondary);
        border-bottom: 1px solid var(--glass-border);
    }
    .catalog-card .archetype-list li:last-child {
        border-bottom: none;
    }


    .catalog-card.level-1 {
      border-top: 3px solid #3b82f6;
    }

    .catalog-card.level-2 {
      border-top: 3px solid #8b5cf6;
    }

    .catalog-card.level-3 {
      border-top: 3px solid #ef4444;
    }
    
    .catalog-card .level-badge {
        margin-right: 0.5rem;
    }
    
    .catalog-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
    }


    .diagram-container {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 2rem;
      padding: 2rem;
      overflow-x: auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .mermaid {
      background: transparent !important;
      min-width: 1200px;
    }

    .fab {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1.5rem;
      box-shadow: 0 8px 30px rgba(99, 102, 241, 0.4);
      transition: all 0.3s;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .fab .icon {
        width: 1.8em;
        height: 1.8em;
    }

    .fab:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 12px 40px rgba(99, 102, 241, 0.6);
    }

    .scroll-top {
      position: fixed;
      bottom: 2rem;
      left: 2rem;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 1.25rem;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    
    .scroll-top .icon {
        width: 1.5em;
        height: 1.5em;
    }

    .scroll-top.visible {
      opacity: 1;
      pointer-events: all;
    }

    .scroll-top:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-4px);
    }

    [data-tooltip] {
      position: relative;
    }

    [data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%) translateY(-8px);
      padding: 0.5rem 1rem;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-radius: 0.5rem;
      font-size: 0.875rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 1000;
    }

    [data-tooltip]:hover::after {
      opacity: 1;
    }
    
    html {
      scroll-behavior: smooth;
    }

    ::selection {
      background: var(--primary);
      color: white;
    }

    .archetype-sop-container {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .archetype-sop-group {
      position: relative;
      cursor: pointer;
    }
    
    
    
    .archetype-sop-group .archetype-card {
        margin-bottom: 0;
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
    }
    
    .archetype-sop-group .archetype-title {
        margin-bottom: 0; /* Remove bottom margin inside the card */
    }

    .sop-connector {
      position: relative;
      padding-left: 2.5rem; /* Space for the connector line */
      margin-top: -1px; /* Overlap slightly for a seamless look */
    }
    
    .sop-connector .sop-chain {
        margin-top: 0;
        border-top-left-radius: 0;
        border-top-right-radius: 0;
    }

    .sop-connector::before {
      content: '';
      position: absolute;
      left: 1.25rem;
      top: 0px;
      width: 1.25rem;
      height: 1.7rem; 
      border-left: 2px solid var(--glass-border);
      border-bottom: 2px solid var(--glass-border);
      border-bottom-left-radius: 0.75rem;
    }

    .archetype-expand-indicator {
      font-size: 1.5rem;
      font-weight: 300;
      color: var(--text-secondary);
      transition: transform 0.3s;
    }

    .archetype-sop-group.details-expanded .archetype-expand-indicator {
      transform: rotate(45deg);
    }
      /* 第 898-911 行改为： */
    .archetype-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      background: rgba(0,0,0,0.2);
      border-bottom-left-radius: 1rem;
      border-bottom-right-radius: 1rem;
      border: 1px solid var(--glass-border);
      border-top: none;
      position: relative;
    }

    .archetype-sop-group.details-expanded .archetype-details {
    max-height: 5000px;
    overflow: visible;
    }   
    
    .sop-details-content {
      padding: 1rem 1.5rem 1.5rem 2.5rem;
      font-family: 'Plus Jakarta Sans', sans-serif;
    }

    .archetype-sop-group.details-expanded .sop-connector {
        display: none;
    }

    .archetype-details h6 {
        font-weight: 700;
        color: var(--primary);
        margin-top: 1rem;
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .archetype-details .sop-list {
        padding-left: 1rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
        line-height: 1.6;
    }
    .archetype-details .sop-list li {
        margin-bottom: 0.5rem;
    }
    .archetype-details .sop-goal {
        color: var(--text-secondary);
        font-style: italic;
    }

    .sop-list .pitfall-critical { color: var(--danger); }
    .sop-list .pitfall-common { color: var(--warning); }
    .sop-list .pro-tip { color: var(--success); }
    
    #legend {
      position: fixed;
      top: 50%;
      right: 2rem;
      transform: translate(120%, -50%);
      width: 300px;
      z-index: 1001;
      transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    #legend.visible {
        transform: translate(0, -50%);
    }
    .legend-card {
        border-radius: 1.5rem;
        padding: 1.5rem;
    }
    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }
    .legend-item:last-child {
        margin-bottom: 0;
    }

  </style>
</head>
<body>
 
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div style="max-width: 1400px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between;">
      <div class="logo">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 19V6.2C4 5.0799 4 4.51984 4.21799 4.09202C4.40973 3.71569 4.71569 3.40973 5.09202 3.21799C5.51984 3 6.0799 3 7.2 3H16.8C17.9201 3 18.4802 3 18.908 3.21799C19.2843 3.40973 19.5903 3.71569 19.782 4.09202C20 4.51984 20 5.0799 20 6.2V17H6C4.89543 17 4 17.8954 4 19ZM4 19C4 20.1046 4.89543 21 6 21H20V19H4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        G3→G4 Evolution
      </div>
      <div style="display: flex; gap: 1rem; align-items: center;">
        <button class="btn btn-secondary" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-tooltip="Back to Top">
          <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M12 5L6 11M12 5L18 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn btn-secondary" onclick="toggleAllCards()" id="expandBtn" data-tooltip="Expand/Collapse All">
          <svg class="icon" id="expand-icon-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 14H21M3 10H21M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero">
    <h1 class="hero-title">G3 → G4 Mathematics Evolution</h1>
    <p class="hero-subtitle">
      An interactive journey through key topics and archetypes. 
      Explore how concepts <strong>deepen</strong>, <strong>extend</strong>, and expand across Secondary 3 to 4.
    </p>
    <div class="stats-grid" id="stats-grid-container"></div>
    <div class="control-panel">
      <div class="search-container" style="margin: 0;">
        <span class="search-icon">
          <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.7955 15.8111L21 21M18 10.5C18 14.6421 14.6421 18 10.5 18C6.35786 18 3 14.6421 3 10.5C3 6.35786 6.35786 3 10.5 3C14.6421 3 18 6.35786 18 10.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </span>
        <input type="text" class="search-box" id="searchInput" placeholder="Search topics, archetypes, SOPs... (Ctrl+K)" oninput="filterContent(this.value)">
        <span class="search-clear" onclick="clearSearch()">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </span>
      </div>
    </div>
    <div class="control-panel">
      <button class="btn btn-primary" onclick="scrollToSection('g3')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 19V6.2C4 5.0799 4 4.51984 4.21799 4.09202C4.40973 3.71569 4.71569 3.40973 5.09202 3.21799C5.51984 3 6.0799 3 7.2 3H16.8C17.9201 3 18.4802 3 18.908 3.21799C19.2843 3.40973 19.5903 3.71569 19.782 4.09202C20 4.51984 20 5.0799 20 6.2V17H6C4.89543 17 4 17.8954 4 19ZM4 19C4 20.1046 4.89543 21 6 21H20V19H4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Explore G3 Topics
      </button>
      <button class="btn btn-primary" onclick="scrollToSection('g4')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21L12 3M12 3L17 8M12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Explore G4 Topics
      </button>
      <button class="btn btn-secondary" onclick="scrollToSection('catalog')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 3H4V9H9V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 15H4V21H9V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 3H15V9H20V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 15H15V21H20V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        View Catalog
      </button>
      <button class="btn btn-secondary" onclick="scrollToSection('diagram')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 20L3 17V4L9 7M9 20L15 17M9 20V7M15 17L21 20V7L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        Evolution Map
      </button>
    </div>
  </section>

  <!-- G3 Topics Section -->
  <section class="section" id="g3">
    <div class="section-header">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <h2 class="section-title">
          <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21L19 17L12 13L5 17L12 21ZM12 21V13M12 13L5 9L12 5L19 9L12 13Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>G3 Topics</span>
        </h2>
        <span class="section-badge badge-g3">Foundation Level</span>
      </div>
      <span style="color: var(--text-secondary); font-size: 0.875rem;">Core + Satellite</span>
    </div>
    <div id="g3-topics-container" class="topic-grid"></div>
  </section>

  <!-- G4 Topics Section -->
  <section class="section" id="g4">
    <div class="section-header">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <h2 class="section-title">
          <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21L12 3M12 3L17 8M12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>G4 Topics</span>
        </h2>
        <span class="section-badge badge-g4">Advanced Level</span>
      </div>
      <span style="color: var(--text-secondary); font-size: 0.875rem;">Core + Satellite + New</span>
    </div>
    <div id="g4-topics-container" class="topic-grid"></div>
  </section>

  <!-- Archetype Catalog Section -->
  <section class="section" id="catalog">
    <div class="topic-card" onclick="toggleCard(this, event)">
      <div class="topic-header">
        <div class="topic-title-group">
          <span class="topic-icon">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 3H4V9H9V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 15H4V21H9V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 3H15V9H20V3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 15H15V21H20V15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </span>
          <div>
            <div class="topic-title">Archetype Catalog</div>
            <div class="topic-subtitle">Browse all archetypes by level</div>
          </div>
        </div>
        <span class="expand-indicator"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 9L12 16L5 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
      </div>
      <div class="topic-content">
        <div class="topic-body">
          <div id="catalog-container" class="catalog-grid"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Evolution Map Section -->
  <section class="section" id="diagram">
    <div class="section-header">
      <h2 class="section-title">
        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 20L3 17V4L9 7M9 20L15 17M9 20V7M15 17L21 20V7L15 4M15 17V4M15 4L9 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>Evolution Map</span>
      </h2>
    </div>
    <div class="diagram-container">
      <div class="mermaid">
graph TD
    subgraph G3["G3 Foundation (L1)"]
        C1["ALG: Algebra"]
        C2["GEO: Geometry"]
        C3["QUAD: Quadratics"]
        C4["TRIG: Trigonometry"]
        S1["CG: Coordinate Geo"]
        S2["INEQ: Inequalities"]
        S4["NUM: Numbers & Ratio"]
        S6["STAT: Stats & Prob"]
    end

    subgraph G4["G4 Advanced (L2/L3)"]
        C5["L2: Algebraic Modelling"]
        C6["L2: Graphical Analysis"]
        C7["L2: 2D/3D Trig"]
        C8["L2: Sim/Congruency App"]
        S8["L1: Vectors & Matrices (New)"]
        M1["L3: Multi-Rep Synthesis"]
        M2["L3: Contextual Modelling"]
    end

    C1 -->|Extends to| C5
    S4 -->|Integrates into| C5
    S2 -->|Integrates into| C5
    
    C3 -->|Deepens to| C6
    S1 -->|Integrates into| C6

    C4 -->|Deepens to| C7
    C2 -->|Integrates into| C7

    C2 -->|Deepens to| C8

    C6 -->|Synthesizes| M1
    C7 -->|Synthesizes| M1

    C5 -->|Models with| M2
    C7 -->|Models with| M2

    classDef l1 fill:#3b82f6,stroke:#60a5fa,color:#fff,stroke-width:2px
    classDef l2 fill:#8b5cf6,stroke:#a78bfa,color:#fff,stroke-width:2px
    classDef l3 fill:#ef4444,stroke:#f87171,color:#fff,stroke-width:2px
    classDef new fill:#f59e0b,stroke:#fbbf24,color:#fff,stroke-width:2px

    class C1,C2,C3,C4,S1,S2,S4,S6 l1
    class C5,C6,C7,C8 l2
    class S8 new
    class M1,M2 l3
      </div>
    </div>
  </section>

  <!-- Floating Legend -->
  <div id="legend">
    <div class="glass legend-card">
      <h3 class="catalog-title" style="margin-bottom: 1rem;">Legend</h3>
      <div class="legend-item">
        <span class="pill pill-core">Core</span> <span> - Fundamental topic stream</span>
      </div>
      <div class="legend-item">
        <span class="pill pill-satellite">Satellite</span> <span> - Important but less central topic</span>
      </div>
        <hr style="border-color: var(--glass-border); margin: 1rem 0;">
      <div class="legend-item">
        <span class="evolution-badge badge-deepening"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M12 5L6 11M12 5L18 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Deepening</span> <span> - Existing topic studied in greater depth</span>
      </div>
      <div class="legend-item">
        <span class="evolution-badge badge-extension"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.023 9.348L12 13.372L7.977 9.348" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 12C2 7.02944 6.02944 3 11 3C15.9706 3 20 7.02944 20 12C20 16.9706 15.9706 21 11 21C7.88684 21 5.15653 19.5592 3.5 17.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> Extension</span> <span> - Existing topic applied to new contexts</span>
      </div>
      <div class="legend-item">
        <span class="evolution-badge badge-addition"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12L12 6M12 12L6 12M12 12L12 18M12 12L18 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Addition</span> <span> - Introduction of a completely new topic</span>
      </div>
      <div class="legend-item">
        <span class="evolution-badge badge-meta"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 10V4.5A2.5 2.5 0 0 0 11.5 2H6.5A2.5 2.5 0 0 0 4 4.5V10H9.5A2.5 2.5 0 0 1 12 12.5V14.5A2.5 2.5 0 0 0 14.5 17H20V11.5A2.5 2.5 0 0 0 17.5 9H14V10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Meta-Integration</span> <span> - Cross-topic synthesis</span>
      </div>
    </div>
  </div>

  <!-- Floating Action Buttons -->
  <button id="scrollTop" class="scroll-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" data-tooltip="Scroll to Top">
    <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 19V5M12 5L18 11M12 5L6 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
  <button class="fab" onclick="toggleLegend()" data-tooltip="Toggle Legend">
    <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12ZM12 12V20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </button>
  
  
  <script>
    // --- EMBEDDED DATA ---
    const ARCHETYPES_DATA = [
      {
        "id": "ARCH-L1-ALG-01", "level": "L1", "name": "Factorisation", "topic": "algebra", "badge": "CORE",
        "description": "Factorising expressions using common factor, difference of squares, or cross-multiplication method.",
        "sop": { "goal": "Break down an algebraic expression into a product of simpler factors.", "steps": [
            "1. Common Factor: Always look for a common factor first.",
            "2. Formula: Check for Difference of Squares (a²-b²) or Perfect Squares.",
            "3. Cross-Method: Use the cross-multiplication method for trinomials."
        ]}
      },
      {
        "id": "ARCH-L1-ALG-02", "level": "L1", "name": "Solving Fractional Equations", "topic": "algebra", "badge": "CORE",
        "description": "Solving fractional equations that reduce to linear or quadratic by clearing denominators.",
        "sop": { "goal": "Eliminate fractions and solve for the variable", "triggers": ["solve", "equation with fractions"], "steps": [
            "1. Identify the LCD of all denominators in the equation.",
            "2. Multiply every term by the LCD: This eliminates all fractions.",
            "3. Simplify and solve: You now have a standard linear or quadratic equation.",
            "4. Check for extraneous solutions: Substitute back to ensure denominators ≠ 0."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Forgetting to multiply ALL terms (including constants) by the LCD" },
            { "type": "COMMON", "text": "Not checking if solutions make any denominator zero" }
        ], "pro_tips": [
            "Write 'LCD = ...' at the top before multiplying",
            "Circle any values that would make denominators zero—these cannot be solutions"
        ]}
      },
      {
        "id": "ARCH-L1-ALG-03", "level": "L1", "name": "Forming Expressions", "topic": "algebra", "badge": "CORE",
        "description": "Translating word problems or scenarios into mathematical algebraic expressions.",
        "sop": { "goal": "Represent a real-world situation using algebraic terms.", "steps": [
            "1. Define Variable: Let the unknown be x.",
            "2. Translate Keywords: Convert words like 'more than' (+), 'product' (×) into math symbols.",
            "3. Write Expression."
        ]}
      },
      {
        "id": "ARCH-L1-ALG-04", "level": "L1", "name": "Adding/Subtracting Algebraic Fractions", "topic": "algebra", "badge": "CORE",
        "description": "Combining fractions with algebraic denominators into a single fraction.",
        "sop": { "goal": "Combine fractions with algebraic denominators into a single fraction", "triggers": ["add", "subtract", "fractions with different denominators"], "steps": [
            "1. Find the LCD (Lowest Common Denominator): Factor all denominators if needed, then find LCD.",
            "2. Convert each fraction: Multiply numerator and denominator by whatever makes the denominator = LCD.",
            "3. Combine numerators: Add or subtract the numerators over the common denominator.",
            "4. Simplify: Factor and cancel common factors if possible."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Not distributing the negative sign when subtracting fractions" },
            { "type": "COMMON", "text": "Forgetting to multiply both numerator AND denominator when converting" }
        ], "pro_tips": [
            "When subtracting, put brackets around the entire second numerator: (a) - (b + c)",
            "Always factor the final numerator and denominator to check for further simplification"
        ]}
      },
      {
        "id": "ARCH-L1-ALG-05", "level": "L1", "name": "Changing the Subject of a Formula", "topic": "algebra", "badge": "CORE",
        "description": "Rearranging a complex formula to isolate a specified variable.",
        "sop": { "goal": "Rearrange to isolate a specified variable", "triggers": ["make x the subject", "express y in terms of"], "steps": [
            "1. Identify the target variable: Circle or highlight what you're solving for.",
            "2. Isolate terms containing the target: Move all other terms to the opposite side.",
            "3. If target appears multiple times, factor it out: x(stuff) = other stuff.",
            "4. Final isolation: Divide both sides to leave target alone.",
            "5. Simplify if needed: Especially with fractions."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Not factoring out when the variable appears in multiple terms" },
            { "type": "COMMON", "text": "Sign errors when moving terms across the equals sign" }
        ], "pro_tips": [
            "When target is in denominator, first multiply both sides by that denominator",
            "If target is squared, remember to take ± square root at the end"
        ]}
      },
      {
        "id": "ARCH-L1-ALG-06", "level": "L1", "name": "Solving Simultaneous Equations", "topic": "algebra", "badge": "CORE",
        "description": "Finding values that satisfy a system of two linear equations.",
        "sop": { "goal": "Find values that satisfy both equations", "triggers": ["simultaneous equations", "solve the system"], "steps": [
            "1. Choose your method: Substitution (if one equation is already solved for a variable) or Elimination.",
            "2. Elimination method: Multiply equations to make coefficients of one variable equal, then add/subtract to eliminate.",
            "3. Solve for first variable: You'll get a simple equation in one variable.",
            "4. Substitute back: Plug the value into either original equation to find the other variable.",
            "5. Verify: Check both values satisfy both original equations."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Not multiplying the entire equation when preparing for elimination" },
            { "type": "COMMON", "text": "Forgetting to find the second variable after eliminating the first" }
        ], "pro_tips": [
            "Label equations as ① and ② to track your work",
            "If coefficients are already opposites, add. If they're the same, subtract"
        ]}
      },
      {
        "id": "ARCH-L1-TRIG-01", "level": "L1", "name": "Solving 2D Bearing / Geometry Problems", "topic": "trigonometry", "badge": "CORE",
        "description": "Application of Sine/Cosine rules in 2D real-world contexts.",
        "sop": { "goal": "To find unknown lengths or angles in non-right-angled triangles", "triggers": ["Bearing of", "due east", "diagrams with non-right-angled triangles"], "steps": [
            "1. Annotate & Convert: Draw all North lines. Convert all given bearings into internal angles of the key triangle using parallel line properties.",
            "2. Assess the Triangle: Count the knowns. Do you have SAS/SSS or AAS/SSA?",
            "3. Select the Right Tool: If SAS or SSS, use the Cosine Rule. If AAS or SSA, use the Sine Rule.",
            "4. Calculate & Check: Solve for the unknown. If finding an angle with the Sine Rule, check if an obtuse angle (180° - θ) is possible."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Mixing up the Sine Rule and Cosine Rule formulas" },
            { "type": "COMMON", "text": "Forgetting to check for the obtuse angle possibility when using Sine Rule" }
        ], "pro_tips": [
            "Memorize: 'If the problem gives you three sides (SSS) or a Side-Angle-Side sandwich (SAS), you need the Cosine Rule. For almost everything else, it's the Sine Rule'",
            "Always draw North lines first to visualize the bearing angles clearly"
        ]}
      },
      {
        "id": "ARCH-L1-TRIG-02", "level": "L1", "name": "Finding Shortest Distance via Area Method", "topic": "trigonometry", "badge": "CORE",
        "description": "Finding the perpendicular distance from a point to a line using area.",
        "sop": { "goal": "To find the perpendicular distance from a point to a line using area", "triggers": ["shortest distance", "perpendicular distance", "from point to line"], "steps": [
            "1. Identify the Triangle: The point and the two endpoints of the line segment form a triangle.",
            "2. Calculate Area Using Sine: Use Area = ½ab sin C with the known sides and included angle.",
            "3. Use Area = ½ × base × height: Set the line segment as the base, and solve for the perpendicular height (which is the shortest distance).",
            "4. Verify: The shortest distance should be less than any direct distance from the point to the line's endpoints."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Forgetting that Area = ½ × base × height must use the perpendicular height" },
            { "type": "COMMON", "text": "Using the wrong side as the base" }
        ], "pro_tips": [
            "This method bypasses the need to find the angle at the base",
            "Double-check: shortest distance < any slant distance"
        ]}
      },
      {
        "id": "ARCH-L1-TRIG-03", "level": "L1", "name": "Bearings", "topic": "trigonometry", "badge": "CORE",
        "description": "Interpreting and using bearings to find angles within geometric problems.",
        "sop": { "goal": "Convert bearing information into usable angles for triangle calculations.", "steps": [
            "1. Draw North Lines at all relevant points.",
            "2. Measure Clockwise from North.",
            "3. Use Geometry (alternate/interior angles) to find triangle's internal angles."
        ]}
      },
      {
        "id": "ARCH-L1-TRIG-04", "level": "L1", "name": "Elevation/Depression", "topic": "trigonometry", "badge": "CORE",
        "description": "Solving problems involving angles of elevation and depression, typically using SOH-CAH-TOA.",
        "sop": { "goal": "Solve right-angled triangle problems in a vertical plane.", "steps": [
            "1. Draw a right-angled triangle.",
            "2. Identify Horizontal (adjacent) and Vertical (opposite) sides.",
            "3. Use SOH-CAH-TOA."
        ]}
      },
      {
        "id": "ARCH-L1-QUAD-01", "level": "L1", "name": "Completing the Square", "topic": "algebra", "badge": "CORE",
        "description": "Converting a quadratic from standard form to completed square form.",
        "sop": { "goal": "Convert quadratic from standard form to completed square form", "triggers": ["complete the square", "express in the form (x + p)² + q"], "steps": [
            "1. Identify coefficient of x²: If it's not 1, factor it out first.",
            "2. Take half of the x coefficient, square it: For x² + bx, take (b/2)².",
            "3. Add and subtract this value inside: x² + bx + (b/2)² - (b/2)².",
            "4. Group to form perfect square: (x + b/2)² - (b/2)² + c.",
            "5. Simplify the constant term: Combine constants to get final form (x + p)² + q."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Forgetting to factor out the coefficient of x² before completing the square" },
            { "type": "COMMON", "text": "Not squaring the half-coefficient correctly" }
        ], "pro_tips": [
            "Always write out the add-and-subtract step explicitly: + (b/2)² - (b/2)²",
            "Check your answer by expanding back to verify"
        ]}
      },
      {
        "id": "ARCH-L1-QUAD-02", "level": "L1", "name": "Graph Sketching (Quadratics)", "topic": "algebra", "badge": "CORE",
        "description": "Sketching a parabola with all key features labeled.",
        "sop": { "goal": "Sketch the parabola with all key features labeled", "triggers": ["sketch the graph", "draw the curve"], "steps": [
            "1. Identify the turning point: Use completed square form (x + p)² + q gives turning point (-p, q).",
            "2. Determine if it opens up or down: Positive coefficient of x² → opens up, Negative → opens down.",
            "3. Find y-intercept: Set x = 0 and calculate y.",
            "4. Find x-intercepts (if they exist): Set y = 0 and solve the quadratic (use formula if needed).",
            "5. Sketch: Draw smooth U-shape through all labeled points."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Getting the sign wrong for the turning point coordinates" },
            { "type": "COMMON", "text": "Forgetting to label all intercepts and the turning point" }
        ], "pro_tips": [
            "If completing the square gives (x - a)² + b, turning point is (a, b) not (-a, b)",
            "Always mark minimum/maximum value clearly"
        ]}
      },
      {
        "id": "ARCH-L1-QUAD-03", "level": "L1", "name": "Finding Equation from Graph", "topic": "algebra", "badge": "CORE",
        "description": "Determining the quadratic equation given key features of the graph.",
        "sop": { "goal": "Determine the quadratic equation given key features of the graph", "triggers": ["find the equation", "given turning point and another point"], "steps": [
            "1. Start with completed square form: Use y = a(x - h)² + k where (h, k) is the turning point.",
            "2. Substitute the other given point: Plug in the coordinates to find the value of a.",
            "3. Solve for a: Isolate a in the equation.",
            "4. Write the final equation: Either in completed square form or expand to standard form if required."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Forgetting to include the coefficient a in front" },
            { "type": "COMMON", "text": "Sign errors when substituting coordinates with negative values" }
        ], "pro_tips": [
            "Always use y = a(x - h)² + k form first, it's faster than y = ax² + bx + c",
            "Verify by checking if the turning point satisfies your final equation"
        ]}
      },
      {
        "id": "ARCH-L1-GEO-01", "level": "L1", "name": "Proving Similarity (AA Criterion)", "topic": "geometry", "badge": "CORE",
        "description": "Proving two triangles are similar, mainly using the AA criterion.",
        "sop": { "goal": "Prove two triangles are similar using Angle-Angle", "triggers": ["prove triangles are similar", "show similarity"], "steps": [
            "1. Identify the two triangles: Label vertices clearly (e.g., △ABC and △DEF).",
            "2. Find two pairs of equal angles: Use properties like vertically opposite angles, corresponding angles, alternate angles, or angles in the same segment.",
            "3. State the equal angles explicitly: Write ∠ABC = ∠DEF and ∠BAC = ∠EDF with reasons.",
            "4. Conclude using AA: State 'Since two angles are equal, △ABC is similar to △DEF (AA)'."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Not providing geometric reasons for why angles are equal" },
            { "type": "COMMON", "text": "Mixing up corresponding vertices when stating similarity" }
        ], "pro_tips": [
            "Common angle reasons: vertically opposite, corresponding (parallel lines), alternate (parallel lines), angles in same segment",
            "Always write the triangle correspondence correctly: △ABC ~ △DEF means A↔D, B↔E, C↔F"
        ]}
      },
      {
        "id": "ARCH-L1-GEO-02", "level": "L1", "name": "Proving Congruency (SAS, SSS, ASA, RHS)", "topic": "geometry", "badge": "CORE",
        "description": "Proving two triangles are congruent using one of the four standard criteria.",
        "sop": { "goal": "Prove two triangles are congruent", "triggers": ["prove triangles are congruent", "show congruency"], "steps": [
            "1. Identify the two triangles: Label all vertices.",
            "2. List what you know: Mark equal sides and angles on the diagram.",
            "3. Determine which test applies: SAS (Side-Angle-Side), SSS (Side-Side-Side), ASA (Angle-Side-Angle), or RHS (Right angle-Hypotenuse-Side).",
            "4. State the equal elements with reasons: e.g., 'AB = DE (given)', '∠ABC = ∠DEF (common angle)'.",
            "5. Conclude: State '△ABC ≅ △DEF (SAS)' with the appropriate criterion."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Using the wrong congruency criterion (e.g., trying to use AAA)" },
            { "type": "COMMON", "text": "For SAS, the angle must be BETWEEN the two equal sides" }
        ], "pro_tips": [
            "SAS: The angle must be included between the two sides",
            "Common reasons: 'common side', 'given', 'opposite equal angles', 'radii of same circle'",
            "ASA vs AAS: For ASA, the side must be between the two angles"
        ]}
      },
      {
        "id": "ARCH-L1-GEO-03", "level": "L1", "name": "Using Similarity to Find Unknown Lengths", "topic": "geometry", "badge": "CORE",
        "description": "Calculating unknown side lengths using the properties of similar triangles.",
        "sop": { "goal": "Calculate unknown side lengths using similar triangles", "triggers": ["find the length", "calculate x", "given similar triangles"], "steps": [
            "1. Confirm similarity: Either it's stated or prove it using SOP 1.",
            "2. Set up the ratio: Write corresponding sides as a proportion. e.g., AB/DE = BC/EF = AC/DF.",
            "3. Substitute known values: Plug in all given lengths.",
            "4. Solve for unknown: Cross-multiply if needed, then isolate the unknown.",
            "5. Check reasonableness: Does the answer make geometric sense?"
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Setting up ratios with non-corresponding sides" },
            { "type": "COMMON", "text": "Inverting the ratio (getting it upside down)" }
        ], "pro_tips": [
            "Draw the triangles separately if they overlap, matching corresponding vertices",
            "Write the similarity statement first (△ABC ~ △DEF) to ensure correct correspondence"
        ]}
      },
      {
        "id": "ARCH-L1-GEO-04", "level": "L1", "name": "Shortest Distance", "topic": "geometry", "badge": "CORE",
        "description": "Finding the shortest distance from a point to a line, which is the perpendicular distance.",
        "sop": { "goal": "Calculate the perpendicular distance from a point to a line.", "steps": [
            "1. Identify the point and the line.",
            "2. Recognize that the shortest distance is the perpendicular distance.",
            "3. Often involves using area formulas (Area = 1/2 * base * height) or trigonometry."
        ]}
      },
      {
        "id": "ARCH-L1-STAT-01", "level": "L1", "name": "Interpreting Stem-and-Leaf Diagrams", "topic": "statistics", "badge": "SAT",
        "description": "Quickly and accurately extracting mode, median, and mean from stem-and-leaf diagrams.",
        "sop": { "goal": "Quickly and accurately extract mode, median, and mean", "triggers": ["stem-and-leaf diagram is presented"], "steps": [
            "1. Count Total (N): Write N beside the diagram—this controls the median.",
            "2. Mode: Scan for the most frequent leaf (recombine with stem).",
            "3. Median: Position is (N + 1) ÷ 2. If N odd → whole position (e.g., 11th). If N even → average of the two middle values (e.g., 13th and 14th).",
            "4. Mean: Sum all values (stem+leaf) and divide by N. Use calculator carefully."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "For even N, forgetting to average the two middle values" },
            { "type": "COMMON", "text": "Miscounting N" }
        ], "pro_tips": [
            "Write N = … on top before doing median",
            "When N is even, pre-write Median = (____ + ____ ) ÷ 2"
        ]}
      },
      {
        "id": "ARCH-L1-STAT-02", "level": "L1", "name": "Interpreting Grouped Frequency Tables", "topic": "statistics", "badge": "SAT",
        "description": "Estimating the mean from a grouped frequency table.",
        "sop": { "goal": "Estimate the mean from a grouped frequency table", "triggers": ["table with class intervals", "140 < h ≤ 150"], "steps": [
            "1. Midpoint (x): For each class, midpoint = (lower + upper) ÷ 2. Example: (140 + 150) ÷ 2 = 145.",
            "2. Compute fx: Multiply midpoint x by frequency f.",
            "3. Sum: Σf (often given) and Σ(fx).",
            "4. Estimate Mean: Mean = Σ(fx) ÷ Σf."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Using interval boundaries instead of midpoints" },
            { "type": "COMMON", "text": "Forgetting to compute an fx column for each row" }
        ], "pro_tips": [
            "Add explicit columns for Midpoint (x) and fx",
            "Do totals (Σf, Σfx) in a separate line to avoid slips"
        ]}
      },
      {
        "id": "ARCH-L1-PROB-01", "level": "L1", "name": "Solving Basic Probability Problems", "topic": "statistics", "badge": "SAT",
        "description": "Accurately calculating the probability of a single event.",
        "sop": { "goal": "Accurately calculate the probability of an event", "triggers": ["probability", "at random"], "steps": [
            "1. Total Outcomes: Identify the size of the sample space.",
            "2. Favourable Outcomes: List them explicitly (do not 'do it in your head'). Example: 'even and divisible by 3' → list evens, then circle those divisible by 3: 6, 12, 18.",
            "3. Compute Probability: P(Event) = Favourable ÷ Total.",
            "4. Simplify the fraction."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Miscounting outcomes for compound 'and/or'" },
            { "type": "COMMON", "text": "Leaving the fraction unsimplified" }
        ], "pro_tips": [
            "Always list the favourable outcomes—never rely on mental counting",
            "Reduce the final fraction (or convert to simplest decimal/percentage if required)"
        ]}
      },
      {
        "id": "ARCH-L1-CG-01", "level": "L1", "name": "Finding the Equation of a Straight Line", "topic": "geometry", "badge": "SAT",
        "description": "Finding the equation of a line in the form y = mx + c.",
        "sop": { "goal": "To find the equation connecting any two points", "triggers": ["Find the equation of the line", "equation passing through"], "steps": [
            "1. Find the Gradient (m): m = (y₂ − y₁) ÷ (x₂ − x₁). Pro-Tip: Label points (x₁,y₁) and (x₂,y₂) before calculating.",
            "2. Write the Partial Equation: y = (your m)x + c.",
            "3. Find the y-intercept (c): Substitute coordinates of one known point (use simpler one) into y = mx + c and solve for c.",
            "4. Write the Final Equation: Combine your m and c values."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Swapping x and y when substituting into y = mx + c" },
            { "type": "COMMON", "text": "Computing m with (x₁,y₁) and (x₂,y₂) reversed by mistake" }
        ], "pro_tips": [
            "Label points clearly (x₁,y₁), (x₂,y₂) before any calculation",
            "After finding m, immediately write y = mx + c, then plug in the simplest point to get c"
        ]}
      },
      {
        "id": "ARCH-L1-CG-02", "level": "L1", "name": "Parallel & Perpendicular Lines", "topic": "geometry", "badge": "SAT",
        "description": "Finding the equation of a new line based on its relationship to another line.",
         "sop": { "goal": "To find the equation of a new line based on its relationship to another line", "triggers": ["parallel to", "perpendicular to"], "steps": [
            "1. Extract the Original Gradient (m₁): Rearrange the given line to y = mx + c first if needed. Gradient m₁ = ...",
            "2. Determine the New Gradient (m₂): Parallel: m₂ = m₁. Perpendicular: m₂ = −1 ÷ m₁ (flip the fraction and change the sign).",
            "3. Use SOP for Line Equation: With m₂ and a point on the new line, repeat steps to find the final equation."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "For perpendicular lines, forgetting to flip AND change sign" },
            { "type": "COMMON", "text": "Not rearranging a general form (like ax + by = c) before reading m" }
        ], "pro_tips": [
            "Box m₁ first, then write m₂ = m₁ (parallel) or m₂ = −1/m₁ (perpendicular)",
            "Once m₂ is fixed, jump straight into the standard line equation flow to finish quickly"
        ]}
      },
      {
        "id": "ARCH-L1-CG-03", "level": "L1", "name": "Finding Length & Area (Coordinate Plane)", "topic": "geometry", "badge": "SAT",
        "description": "Calculating the distance between points or the area of a polygon on a coordinate plane.",
         "sop": { "goal": "To calculate the distance between points or the area of a triangle", "triggers": ["Find the length of", "Find the area of"], "steps": [
            "1. Length of a Line Segment: Distance = √[(x₂−x₁)² + (y₂−y₁)²].",
            "2. Area of a Triangle (axis-aligned side): If one side is horizontal or vertical, use it as the base. Height is the perpendicular distance from the third vertex. Area = ½ × base × height.",
            "3. Area of a General Triangle (Shoelace): List the vertices anti-clockwise and repeat the first at the end. Area = ½ × |(x₁y₂ + ...) − (y₁x₂ + ...)|."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Misordering coordinates in Shoelace → wrong magnitude/sign" },
            { "type": "COMMON", "text": "Dropping negative signs in distance/area calculations" }
        ], "pro_tips": [
            "For Shoelace, write points anti-clockwise and repeat the first at the bottom",
            "If any side is axis-aligned, prefer ½ × base × height over Shoelace"
        ]}
      },
      {
        "id": "ARCH-L1-MEN-01", "level": "L1", "name": "Master SOP for ALL Mensuration Problems", "topic": "mensuration", "badge": "SAT",
        "description": "A master strategy to never lose marks due to formula or calculation errors in mensuration.",
        "sop": { "goal": "To never lose marks due to formula or calculation errors", "triggers": ["area", "surface area", "volume", "capacity"], "steps": [
            "1. Identify the Shape(s): Name them immediately (e.g., cone + hemisphere).",
            "2. Write the Formula FIRST: e.g., write CSA = πrl before substituting. (Secures method marks).",
            "3. List Variables: Example: r = 8, l = 17.",
            "4. Substitute and Calculate: Carefully.",
            "5. Final Check (Units & Accuracy): Correct units (e.g., cm², cm³) and required s.f./d.p."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Missing/incorrect units → lose accuracy/answer marks" },
            { "type": "COMMON", "text": "Substituting numbers before writing the exact formula" }
        ], "pro_tips": [
            "Always write the formula first to lock in method marks",
            "Box the final answer with units and accuracy"
        ]}
      },
      {
        "id": "ARCH-L1-MEN-02", "level": "L1", "name": "Similar Figures & Solids", "topic": "mensuration", "badge": "SAT",
        "description": "Correctly using scaling laws for length, area, and volume for similar figures.",
         "sop": { "goal": "Correctly use scaling laws for length, area, and volume", "triggers": ["similar", "same shape but different size"], "steps": [
            "1. Find the Length Ratio (k) FIRST: k = Length₁ ÷ Length₂.",
            "2. Identify the Target: Area or Volume/Capacity/Mass?",
            "3. Apply Power Rule: Area ratio = k². Volume/Capacity/Mass ratio = k³.",
            "4. Set up Proportion & Solve: Plug numbers into the correct ratio equation."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Using k for area/volume without squaring/cubing" },
            { "type": "COMMON", "text": "Swapping numerator/denominator (wrong object on top)" }
        ], "pro_tips": [
            "Always write k first, then immediately write k² or k³ before numbers",
            "Draw a mini table with three rows: Length / Area / Volume = k / k² / k³"
        ]}
      },
      {
        "id": "ARCH-L1-MEN-03", "level": "L1", "name": "Composite Solids", "topic": "mensuration", "badge": "SAT",
        "description": "Finding the Total Surface Area (TSA) or Total Volume of combined shapes.",
         "sop": { "goal": "Find Total Surface Area (TSA) or Total Volume of combined shapes", "triggers": ["combined shapes", "cone + hemisphere", "composite solid"], "steps": [
            "1. Deconstruct the Shape: List the basic parts clearly.",
            "2. Calculate Each Part Separately: Volume: sum volumes of parts. TSA (TRAP): only exposed surfaces count. Do NOT add base areas that are glued/hidden.",
            "3. Sum the Exposed Parts for TSA; sum volumes for total volume."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Double-counting hidden/glued faces in TSA" },
            { "type": "COMMON", "text": "Mixing up CSA vs TSA formulas or incorrectly adding base areas" }
        ], "pro_tips": [
            "Make a checklist of faces; mark 'hidden' vs 'exposed'",
            "Calculate and label each part with units before summing"
        ]}
      },
      {
        "id": "ARCH-L1-MEN-04", "level": "L1", "name": "Sector & Segment Problems", "topic": "mensuration", "badge": "SAT",
        "description": "Accurately calculating properties of circle parts like sectors and segments.",
         "sop": { "goal": "Accurately calculate properties of circle parts", "triggers": ["sector", "segment", "arc length"], "steps": [
            "1. Check Angle Unit: Degrees vs radians determines formulas.",
            "2. Sector First: Arc length: (θ÷360)×2πr (degrees) or rθ (radians). Sector area: (θ÷360)×πr² (degrees) or ½r²θ (radians).",
            "3. Segment: Master idea: Area of Segment = Area of Sector − Area of Triangle. Triangle area (using included angle): ½ab sinC. Perform the subtraction."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Using degree formulas on radian inputs (or vice-versa)" },
            { "type": "COMMON", "text": "Forgetting to subtract the triangle for a segment" }
        ], "pro_tips": [
            "Circle the angle unit at the start",
            "Always write 'Segment = Sector − Triangle' before substituting numbers"
        ]}
      },
      {
        "id": "ARCH-L1-INEQ-01", "level": "L1", "name": "Solving Compound Inequalities", "topic": "algebra", "badge": "SAT",
        "description": "Finding the final, single range of x for a compound inequality.",
        "sop": { "goal": "To find the final, single range of x", "triggers": ["two inequality signs", "A < B ≤ C"], "steps": [
            "1. SPLIT: Break into two simpler inequalities. Example: 3x − 1 < 2x + 9 ≤ 15 → Part A & Part B.",
            "2. SOLVE: Solve Part A and Part B individually.",
            "3. CRITICAL RULE: If you multiply or divide by a negative, you MUST flip the inequality sign.",
            "4. DRAW: Draw a number line and mark key values.",
            "5. PLOT & OVERLAP: Plot both solutions; the final answer is the overlap.",
            "6. WRITE: Write as a single compound inequality (e.g., 4 < x ≤ 10)."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Not flipping the sign after multiplying/dividing by a negative" },
            { "type": "COMMON", "text": "Using the wrong open/closed circle on the number line" }
        ], "pro_tips": [
            "Write a banner note at the top: '× or ÷ negative → flip sign'",
            "Always sketch the number line before writing the final compound form"
        ]}
      },
      {
        "id": "ARCH-L1-INEQ-02", "level": "L1", "name": "Modelling with Inequalities", "topic": "algebra", "badge": "SAT",
        "description": "Translating real-world language into a precise inequality.",
        "sop": { "goal": "Translate real-world language into a precise inequality", "triggers": ["at least", "no more than", "minimum", "maximum"], "steps": [
            "1. DEFINE: 'Let x be …' (define the variable clearly).",
            "2. TRANSLATE KEYWORDS: at least/minimum → ≥, at most/maximum/no more than → ≤, more than → >, less than → <.",
            "3. CONSTRUCT: Build the inequality with the numbers and your symbol."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Misreading 'at least/at most' leading to the wrong inequality direction" },
            { "type": "COMMON", "text": "Forgetting to define the variable first" }
        ], "pro_tips": [
            "Underline the keyword and immediately write its symbol (≥, ≤, >, <)",
            "Start with 'Let x = …' to anchor the model"
        ]}
      },
      {
        "id": "ARCH-L1-INEQ-03", "level": "L1", "name": "Finding Max/Min Values in a Range", "topic": "algebra", "badge": "SAT",
        "description": "Finding the absolute maximum or minimum value of an expression within given ranges.",
        "sop": { "goal": "To find the absolute maximum or minimum value of an expression", "triggers": ["largest value", "smallest value", "with given ranges"], "steps": [
            "1. LIST BOUNDARIES: Write x_min, x_max, y_min, y_max.",
            "2. ANALYZE THE GOAL: To maximize y - x³, choose y_max and the smallest possible x³. To minimize y - 2x, choose y_min and the largest possible 2x.",
            "3. CALCULATE: Substitute boundary values and compute."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Choosing the wrong boundary combination (entire result wrong)" },
            { "type": "COMMON", "text": "Forgetting that odd powers keep sign (e.g., (−9)³ = −729)" }
        ], "pro_tips": [
            "Draw a quick 2×2 boundary table for x and y, then pick the combo that matches the goal",
            "Do a quick mental 'sanity check' before finalizing"
        ]}
      },
      {
        "id": "ARCH-L1-IND-01", "level": "L1", "name": "Simplifying Complex Index Expressions", "topic": "algebra", "badge": "SAT",
        "description": "Reducing complicated expressions to simplest form with positive indices.",
        "sop": { "goal": "Reduce complicated expressions to simplest form with positive indices", "triggers": ["Simplify", "expressions with powers, roots, negatives"], "steps": [
            "1. Brackets First (Power of a Power): Multiply indices inside brackets. Examples: (p³)² = p⁶.",
            "2. Handle Negatives & Roots: Negative indices → reciprocals: x⁻³ = 1 ÷ x³. Roots → fractional indices: √x = x^(1/2).",
            "3. Combine Same Bases: Multiply same base → add indices. Divide same base → subtract indices.",
            "4. Calculate Coefficients: Manage normal numbers separately; then recombine."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Treating negative indices as negative numbers (instead of reciprocals)" },
            { "type": "COMMON", "text": "Forgetting to distribute powers across brackets and coefficients" }
        ], "pro_tips": [
            "Convert roots to fractional indices and negatives to reciprocals FIRST",
            "Separate coefficient arithmetic from index manipulation, then recombine"
        ]}
      },
      {
        "id": "ARCH-L1-IND-02", "level": "L1", "name": "Solving Exponential Equations", "topic": "algebra", "badge": "SAT",
        "description": "Finding the unknown in the exponent by unifying the base.",
        "sop": { "goal": "Find the unknown in the exponent", "triggers": ["Solve", "variables appear as powers"], "steps": [
            "1. Unify the Base (Golden Rule): Write all numbers as powers of the SAME base. Examples: 9 = 3², 27 = 3³.",
            "2. Simplify Both Sides: Use simplification rules until you get base^a = base^b.",
            "3. Equate the Indices: Set a = b.",
            "4. Solve: Finish the (usually linear) equation."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Trying to equate indices BEFORE unifying the base" },
            { "type": "COMMON", "text": "Mishandling fractional/negative powers during simplification" }
        ], "pro_tips": [
            "Always rewrite numbers as prime-base powers first",
            "Keep a tiny scratch list of common conversions (e.g., 8 = 2³, 81 = 3⁴)"
        ]}
      },
      {
        "id": "ARCH-L1-IND-03", "level": "L1", "name": "Handling '+' or '−' in Exponential Equations", "topic": "algebra", "badge": "SAT",
        "description": "Solving exponential equations that involve addition or subtraction by factoring.",
        "sop": { "goal": "Solve exponential equations that involve addition or subtraction", "triggers": ["Sums/differences of like exponentials"], "steps": [
            "1. Identify the Trap: Index laws do NOT apply across + or −.",
            "2. Factor / Combine Like Terms: Treat repeated exponentials like like-terms. Examples: 3³ + 3³ + 3³ = 3 × (3³); 2^(x+1) − 2^x = 2^x (2 − 1).",
            "3. Simplify → Switch to Solving Exponential Equations SOP: Reduce to a standard exponential form."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Forcing index laws over sums/differences" },
            { "type": "COMMON", "text": "Forgetting to factor out the common exponential term" }
        ], "pro_tips": [
            "'Apples with apples': combine identical bases/powers first",
            "After factoring, look for the single-base structure and revert to the standard solving SOP"
        ]}
      },
      {
        "id": "ARCH-L1-IND-04", "level": "L1", "name": "Calculating with Standard Form", "topic": "algebra", "badge": "SAT",
        "description": "Performing calculations with scientific notation and ensuring the final answer is in proper standard form.",
        "sop": { "goal": "Perform calculations with A × 10^n and end in proper standard form (1 ≤ A < 10)", "triggers": ["numbers given in scientific notation"], "steps": [
            "1. Multiplication / Division: 1) Multiply/divide the A parts. 2) Apply index laws to the 10^n parts. 3) Adjust to make 1 ≤ A < 10.",
            "2. Addition / Subtraction: 1) Unify the exponent. 2) Factor out the common 10^n. 3) Add/subtract the A parts. 4) Adjust A back to [1, 10) if needed."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Adding/subtracting without matching powers of 10" },
            { "type": "COMMON", "text": "Leaving A outside [1, 10)" }
        ], "pro_tips": [
            "For +/−, match exponents first, then work on the A parts",
            "Always do a final 'standard-form check'"
        ]}
      },
      {
        "id": "ARCH-L1-RATIO-01", "level": "L1", "name": "Map Scale Problems", "topic": "numbers", "badge": "SAT",
        "description": "Accurately converting between map distances and actual distances/areas.",
        "sop": { "goal": "Accurately convert between map distances and actual distances/areas", "triggers": ["Scale 1 : n", "area on the map", "actual area"], "steps": [
            "1. Write the 'Dual Scales': Length scale: 1 cm : (n ÷ 100,000) km. Area scale: 1 cm² : (n ÷ 100,000)² km².",
            "2. Select the Correct Scale: Decide if it's length or area.",
            "3. Proportion & Solve: Actual Distance = Map Distance × (length scale factor). Map Area = Actual Area ÷ (area scale factor)."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Using the length scale to compute an area" },
            { "type": "COMMON", "text": "Forgetting to square when switching to area" }
        ], "pro_tips": [
            "Always write BOTH scales first (length and area)",
            "Circle the word 'Area' in the question → write 'square it' beside it"
        ]}
      },
      {
        "id": "ARCH-L1-RATIO-02", "level": "L1", "name": "Percentage Change & Reverse Percentage", "topic": "numbers", "badge": "SAT",
        "description": "Calculating the new value after a percentage change, or recovering the original value.",
        "sop": { "goal": "Calculate the new value after change, or recover the original value", "triggers": ["increase by X%", "discount", "GST", "after the increase"], "steps": [
            "1. Identify the '100%': Always the original value / cost price / pre-tax price.",
            "2. Compute New Percentage: Increase 15% → new % = 115%. Discount 20% → new % = 80%.",
            "3. Execute: Forward (new value): New = Original × (New% ÷ 100). Reverse (original): Original = New ÷ (New% ÷ 100)."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "In reverse percentage, multiplying instead of dividing by the new percentage" },
            { "type": "COMMON", "text": "Setting '100%' to the new (changed) value" }
        ], "pro_tips": [
            "Underline the '100% reference' (Original/Cost/Pre-tax) before any calculation",
            "Write a reminder: 'Original? → divide by new%'"
        ]}
      },
      {
        "id": "ARCH-L1-RATIO-03", "level": "L1", "name": "Simple & Compound Interest", "topic": "numbers", "badge": "SAT",
        "description": "Computing total amount and interest for simple and compound interest scenarios.",
        "sop": { "goal": "Compute total amount and interest for simple/compound interest", "triggers": ["simple interest", "compound interest", "per annum", "compounded quarterly/half-yearly"], "steps": [
            "1. Identify Type & Parameters: P = Principal, R = annual rate, T = time (years), n = compounding per year.",
            "2. Write Formula: Simple: I = P × (R ÷ 100) × T. Compound: A = P × (1 + (R ÷ n) ÷ 100)^(n × T).",
            "3. Substitute Carefully & Calculate: For compound, divide R by n, multiply T by n.",
            "4. Answer the Question: If they want interest, use A − P."
        ], "pitfalls": [
            { "type": "CRITICAL", "text": "Forgetting R → R/n and T → nT for compounding" },
            { "type": "COMMON", "text": "Confusing interest vs total amount" }
        ], "pro_tips": [
            "As soon as you read 'compounded …', jot n = …, then write R → R/n, T → nT",
            "If the question says 'interest', remember to compute A − P"
        ]}
      },
      {
        "id": "ARCH-L2-TRIG-01", "level": "L2", "name": "2D/3D Trigonometry in Context", "topic": "trigonometry", "badge": "CORE", "grade": "G4",
        "description": "Multi-step problems requiring students to model a real-world scenario on a 2D plane, solve for 'bridge' values, and then use them in a vertical 2D plane to solve 3D elevation/depression problems.",
        "constituent_l1_ids": ["ARCH-L1-TRIG-01", "ARCH-L1-TRIG-03", "ARCH-L1-TRIG-04", "ARCH-L1-GEO-04"],
        "sop": { "goal": "Solve a complex 3D problem by breaking it down into 2D triangle calculations.", "steps": [
            "1. Call SOP-L1-BEARING: Convert all bearings to internal angles to solve the 'ground plane' triangle.",
            "2. Call SOP-L1-TRIG-RULES: Use Sine/Cosine Rule to solve the 'ground plane' triangle.",
            "3. Call SOP-L1-SOHCAHTOA: Use the result from step 2 as the 'bridge' to solve the 'vertical plane' right-angled triangle.",
            "4. (If needed) Call SOP-L1-SHORTEST-DIST: Use the Area Method if the question asks for 'greatest angle of elevation'."
        ]}
      },
      {
        "id": "ARCH-L2-QUAD-01", "level": "L2", "name": "Graphical Analysis of Functions", "topic": "algebra", "badge": "CORE", "grade": "G4",
        "description": "Problems that require students to plot a function (quadratic or cubic) and use the graph to solve equations by finding intersections with a suitable straight line, or finding the gradient of a tangent.",
        "constituent_l1_ids": ["ARCH-L1-QUAD-02", "ARCH-L1-ALG-02", "ARCH-L1-CG-01"],
        "sop": { "goal": "Use a plotted graph to solve related equations and find gradients.", "steps": [
            "1. Call SOP-L1-PLOT-GRAPH: Accurately plot points and draw a smooth curve.",
            "2. Call SOP-L1-ALG-TRANSFORM: Algebraically manipulate the target equation to isolate the original function y on one side. The other side is the y=mx+c to be drawn.",
            "3. Call SOP-L1-LINE-DRAW: Find two points and draw the straight line.",
            "4. Call SOP-L1-READ-GRAPH: Read the coordinates of intersection points or draw a tangent to find the gradient."
        ]}
      },
      {
        "id": "ARCH-L2-GEO-01", "level": "L2", "name": "Similarity & Congruency Application", "topic": "geometry", "badge": "CORE", "grade": "G4",
        "description": "Problems where proving similarity or congruency is the first step. The results (e.g., proportional sides) are then used as tools to perform subsequent calculations for unknown lengths, area ratios, etc.",
        "constituent_l1_ids": ["ARCH-L1-GEO-01", "ARCH-L1-GEO-02", "ARCH-L1-GEO-03"],
        "sop": { "goal": "Use the properties of similar or congruent triangles to solve for other unknown quantities.", "steps": [
            "1. Call SOP-L1-PROVE-SIMILAR: Use AA to prove the required triangles are similar. Write this out formally.",
            "2. Call SOP-L1-RATIO-SETUP: Set up the correct ratio of corresponding sides or the ratio of areas (by squaring the length ratio).",
            "3. Call SOP-L1-SOLVE-PROPORTION: Substitute known values and solve for the unknown length or area."
        ]}
      },
      {
        "id": "ARCH-L2-ALG-01", "level": "L2", "name": "Algebraic Modelling in Context", "topic": "algebra", "badge": "CORE", "grade": "G4",
        "description": "Word problems (e.g., speed/distance/time, financial) where the student must first translate the text into one or more algebraic equations (often fractional or quadratic) and then solve them.",
        "constituent_l1_ids": ["ARCH-L1-ALG-02", "ARCH-L1-ALG-03", "ARCH-L1-RATIO-02"],
        "sop": { "goal": "Create and solve an algebraic equation from a real-world scenario.", "steps": [
            "1. Call SOP-L1-FORM-EXPRESSION: Translate the words into mathematical expressions (e.g., Time = Distance/Speed).",
            "2. Call SOP-L1-FORM-EQUATION: Link the expressions with the final piece of information (e.g., 'the difference in time is 20 minutes') to form an equation.",
            "3. Call SOP-L1-SOLVE-EQUATION: Use algebraic manipulation to solve the resulting equation."
        ]}
      },
      {
        "id": "ARCH-L3-SYN-01", "level": "L3", "name": "Multi-Representation Synthesis", "topic": "meta", "badge": "SAT", "grade": "G4",
        "description": "Tasks where students must synthesize information from multiple representations – algebraic equations, geometric diagrams, and data tables – to arrive at a solution. The core skill is fluently translating between them.",
        "source_l2_ids": ["ARCH-L2-QUAD-01", "ARCH-L2-TRIG-01"],
        "sop": { "goal": "Integrate information from different mathematical formats to solve a complex problem.", "steps": [
            "1. Deconstruct & Diagram: Read the entire problem. Use a highlighter. Draw a large, clear diagram. Translate all textual information onto this diagram.",
            "2. Analyze & Archetype: Look at your diagram. Ask: 'What L2 Archetypes does this problem contain?'",
            "3. Route & Plan: Create a quick, step-by-step plan linking the different parts of the problem.",
            "4. Execute & Explain: Execute the plan step-by-step, calling upon the necessary L2 and L1 SOPs. Write down every step clearly, showing your formulas and reasoning."
        ]}
      },
      {
        "id": "ARCH-L3-MOD-01", "level": "L3", "name": "Contextual Modelling & Justification", "topic": "meta", "badge": "SAT", "grade": "G4",
        "description": "Represents the highest level of application, where the problem is open-ended and may not have a single 'correct' answer. The student must select appropriate models, state assumptions, perform calculations, and justify their final decision.",
        "source_l2_ids": ["ARCH-L2-ALG-01", "ARCH-L2-TRIG-01"],
        "sop": { "goal": "Develop a mathematical model for an open-ended problem and justify the conclusion.", "steps": [
            "1. Deconstruct & Diagram: Read the entire problem. Highlight key data and constraints. Draw a diagram.",
            "2. Analyze & Archetype: Identify the underlying L2 problem type (e.g., 'This is a Trig problem') and the additional justification element.",
            "3. Route & Plan: Create a step-by-step plan. 'First, I will solve the L2 part. Second, I will calculate the costs/options. Finally, I will compare and write my conclusion.'",
            "4. Execute & Explain: Execute the plan clearly. For 'Justify' questions, write your final answer in a full sentence, referencing your calculations."
        ]}
      }
    ];

    // --- APPLICATION LOGIC ---
    let allExpanded = false;

    function initializeApp() {
      mermaid.initialize({ 
        startOnLoad: true, 
        theme: 'dark',
        flowchart: { curve: 'basis' }
      });
      renderAllContent();
      setupEventListeners();
    }

    function renderAllContent() {
        if (typeof ARCHETYPES_DATA === 'undefined' || ARCHETYPES_DATA.length === 0) {
            console.error("ARCHETYPES_DATA is not defined or is empty. Cannot render content.");
            document.getElementById('g3-topics-container').innerHTML = "<p>Error: Data not loaded.</p>";
            document.getElementById('g4-topics-container').innerHTML = "<p>Error: Data not loaded.</p>";
            return;
        }

        const stats = {
            topics: new Set(),
            archetypes: ARCHETYPES_DATA.length,
            levels: new Set()
        };
        ARCHETYPES_DATA.forEach(a => {
            stats.topics.add(a.topic);
            stats.levels.add(a.level);
        });

        document.getElementById('stats-grid-container').innerHTML = `
            <div class="stat-card">
                <div class="stat-icon">📚</div><div class="stat-value">${stats.topics.size}</div><div class="stat-label">Topics</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🎯</div><div class="stat-value">${stats.archetypes}</div><div class="stat-label">Archetypes</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📶</div><div class="stat-value">${stats.levels.size}</div><div class="stat-label">Levels</div>
            </div>
             <div class="stat-card">
                <div class="stat-icon">🔗</div><div class="stat-value">∞</div><div class="stat-label">SOP Chains</div>
            </div>
        `;

        const topics = ARCHETYPES_DATA.reduce((acc, arch) => {
            if (!acc[arch.topic]) {
                acc[arch.topic] = { g3: [], g4: [] };
            }
            if (arch.level === 'L1') {
                acc[arch.topic].g3.push(arch);
            } else { 
                acc[arch.topic].g4.push(arch);
            }
            return acc;
        }, {});
        
        const g3Container = document.getElementById('g3-topics-container');
        const g4Container = document.getElementById('g4-topics-container');
        const catalogContainer = document.getElementById('catalog-container');

        g3Container.innerHTML = '';
        g4Container.innerHTML = '';
        
        const sortedTopicKeys = Object.keys(topics).sort();

        for (const topicKey of sortedTopicKeys) {
            const topicData = topics[topicKey];
            if (topicData.g3.length > 0) {
                g3Container.innerHTML += createTopicCard(topicKey, topicData.g3, 'G3');
            }
            if (topicData.g4.length > 0) {
                g4Container.innerHTML += createTopicCard(topicKey, topicData.g4, 'G4');
            }
        }
        
        renderCatalog(catalogContainer);
        
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = '1';
              entry.target.style.transform = 'translateY(0)';
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });

        document.querySelectorAll('.topic-card, .catalog-card').forEach(el => {
            if(el.style.opacity !== '1') {
                el.style.opacity = '0';
                el.style.transform = 'translateY(30px)';
                el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                observer.observe(el);
            }
        });
    }

    function createTopicCard(topicKey, archetypes, grade) {
        const topicName = topicKey.charAt(0).toUpperCase() + topicKey.slice(1);
        const isCore = archetypes.some(a => a.badge === 'CORE');
        const cardType = isCore ? 'card-core' : 'card-satellite';
        const pillType = isCore ? 'pill-core' : 'pill-satellite';
        const pillText = isCore ? 'Core' : 'Satellite';

        const sopChainSummary = (arch) => {
            if (arch.source_l2_ids && arch.source_l2_ids.length > 0) return `Integrates: ${arch.source_l2_ids.join(', ')}`;
            if (arch.constituent_l1_ids && arch.constituent_l1_ids.length > 0) return `Calls: ${arch.constituent_l1_ids.join(', ')}`;
            return (arch.sop && arch.sop.steps && arch.sop.steps.length > 0) ? arch.sop.steps[0].split(':').slice(1).join(':').trim() : arch.description;
        };
        
        const archetypesHtml = archetypes.sort((a,b) => a.id.localeCompare(b.id)).map(arch => {
            let fullSopHtml = '<div class="sop-details-content">';
            if (arch.sop) {
                if(arch.sop.goal) {
                    fullSopHtml += `<h6>🎯 Goal</h6><p class="sop-goal">${arch.sop.goal}</p>`;
                }
                if (arch.sop.steps) {
                    fullSopHtml += `<h6>📝 Steps</h6><ol class="sop-list">${arch.sop.steps.map(s => `<li>${s.replace(/^(\d+\.\s*)/, '')}</li>`).join('')}</ol>`;
                }
                if (arch.sop.pitfalls) {
                    fullSopHtml += `<h6>⚠️ Pitfalls</h6><ul class="sop-list">${arch.sop.pitfalls.map(p => `<li class="pitfall-${p.type.toLowerCase()}"><strong>${p.type}:</strong> ${p.text}</li>`).join('')}</ul>`;
                }
                if (arch.sop.pro_tips) {
                    fullSopHtml += `<h6>💡 Pro Tips</h6><ul class="sop-list">${arch.sop.pro_tips.map(t => `<li class="pro-tip">${t}</li>`).join('')}</ul>`;
                }
            } else {
                fullSopHtml += '<p>No detailed SOP available.</p>';
            }
            fullSopHtml += '</div>';

            return `
            <div class="archetype-sop-group" onclick="toggleArchetypeDetails(this)">
                <div class="archetype-card level-${arch.level.charAt(1)}">
                    <div class="archetype-title">
                        <span class="level-badge">${arch.level}</span>
                        ${arch.name}
                    </div>
                    <span class="archetype-expand-indicator">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 6V18M6 12H18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </span>
                </div>
                <div class="sop-connector">
                    <div class="sop-chain">${sopChainSummary(arch)}</div>
                </div>
                <div class="archetype-details">
                    ${fullSopHtml}
                </div>
            </div>
        `}).join('');

        return `
            <div class="topic-card ${cardType}" data-keywords="${topicKey} ${archetypes.map(a => `${a.name} ${a.description}`).join(' ')}" onclick="toggleCard(this, event)">
                <div class="topic-header">
                    <div class="topic-title-group">
                        <span class="topic-icon">🧩</span>
                        <div>
                            <div class="topic-title">${topicName}</div>
                            <div class="topic-subtitle">${archetypes.length} Archetype${archetypes.length > 1 ? 's' : ''}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span class="pill ${pillType}">${pillText}</span>
                        <span class="expand-indicator"><svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M19 9L12 16L5 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    </div>
                </div>
                <div class="topic-content">
                    <div class="topic-body">
                        <div class="archetype-sop-container">${archetypesHtml}</div>
                    </div>
                </div>
            </div>
        `;
    }
    
    function renderCatalog(container) {
        const levels = { 'L1': [], 'L2': [], 'L3': [] };
        ARCHETYPES_DATA.forEach(arch => {
            if (levels[arch.level]) {
                levels[arch.level].push(arch);
            }
        });

        container.innerHTML = `
            <div class="catalog-card level-1">
                <h3 class="catalog-title">Level 1 Archetypes (${levels['L1'].length})</h3>
                <ul class="archetype-list">
                    ${levels['L1'].sort((a,b) => a.id.localeCompare(b.id)).map(a => `<li><span class="level-badge">L1</span> ${a.name} (${a.topic})</li>`).join('')}
                </ul>
            </div>
            <div class="catalog-card level-2">
                <h3 class="catalog-title">Level 2 Archetypes (${levels['L2'].length})</h3>
                <ul class="archetype-list">
                    ${levels['L2'].sort((a,b) => a.id.localeCompare(b.id)).map(a => `<li><span class="level-badge">L2</span> ${a.name} (${a.topic})</li>`).join('')}
                </ul>
            </div>
            <div class="catalog-card level-3">
                <h3 class="catalog-title">Level 3 Archetypes (${levels['L3'].length})</h3>
                <ul class="archetype-list">
                    ${levels['L3'].sort((a,b) => a.id.localeCompare(b.id)).map(a => `<li><span class="level-badge">L3</span> ${a.name} (${a.topic})</li>`).join('')}
                </ul>
            </div>
        `;
    }

    function setupEventListeners(){
        document.body.addEventListener('mousemove', (e) => {
            const card = e.target.closest('.topic-card');
            if (card) {
                const rect = card.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                card.style.setProperty('--mouse-x', `${x}%`);
                card.style.setProperty('--mouse-y', `${y}%`);
            }
        });

        window.addEventListener('scroll', () => {
            const scrollTopBtn = document.getElementById('scrollTop');
            if (window.pageYOffset > 300) { scrollTopBtn.classList.add('visible'); } 
            else { scrollTopBtn.classList.remove('visible'); }
        });

        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') { 
                e.preventDefault(); 
                document.getElementById('searchInput').focus(); 
            }
            if (e.key === 'Escape') { 
                clearSearch(); 
                document.getElementById('searchInput').blur(); 
            }
        });
    }

    function toggleCard(card, event) {
      if (event.target.closest('.archetype-sop-group')) {
        return; 
      }
      card.classList.toggle('expanded');
    }
    
    function toggleArchetypeDetails(group) {
        group.classList.toggle('details-expanded');
    }

    function toggleAllCards() {
        const cards = document.querySelectorAll('.topic-card');
        const expandIcon = document.getElementById('expand-icon-svg');
        allExpanded = !allExpanded;
        cards.forEach(card => {
            if (allExpanded) {
            card.classList.add('expanded');
            } else {
            card.classList.remove('expanded');
            }
        });
        if (expandIcon) {
            if (allExpanded) {
                expandIcon.innerHTML = `<path d="M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />`;
            } else {
                expandIcon.innerHTML = `<path d="M3 14H21M3 10H21M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`;
            }
        }
    }

    function scrollToSection(id) { 
      const element = document.getElementById(id);
      if(element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'start' }); 
      }
    }

    function filterContent(query) {
      const cards = document.querySelectorAll('.topic-card');
      const lowerQuery = query.toLowerCase().trim();
      let foundMatch = false;

      cards.forEach(card => {
        if (!query) { 
          card.style.display = 'block'; 
          return; 
        }
        const keywords = card.getAttribute('data-keywords') || '';
        const matches = keywords.toLowerCase().includes(lowerQuery);
        card.style.display = matches ? 'block' : 'none';
        if(matches) foundMatch = true;
      });
    }

    function clearSearch() {
      const input = document.getElementById('searchInput');
      input.value = '';
      filterContent('');
    }

    function toggleLegend() {
      document.getElementById('legend').classList.toggle('visible');
    }

    // Initialize the application once the DOM is fully loaded.
    document.addEventListener('DOMContentLoaded', initializeApp);

  </script>
</body>
</html>

