<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Combined Science - Chem & Phys Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     <!-- 删除-->
    <!-- 核心修改点：增加 Firebase SDK 引用 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
        <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #667eea; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; color: white; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .header .planner-link { display: inline-block; margin-top: 15px; padding: 10px 20px; background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.4); text-decoration: none; border-radius: 20px; font-weight: 500; font-size: 0.9em; transition: all 0.3s ease; }
        .header .planner-link:hover { background: rgba(255, 255, 255, 0.3); }
        .dashboard { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px; }
        .main-panel, .side-panel .widget { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .side-panel { display: flex; flex-direction: column; gap: 20px; }
        .section-title { font-size: 1.5rem; font-weight: 600; margin-bottom: 20px; color: #2d3748; }
        .subject-section { margin-bottom: 30px; }
        .subject-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 15px 20px; background: linear-gradient(135deg, #4299e1, #3182ce); color: white; border-radius: 10px; }
        .subject-title { font-size: 1.3rem; font-weight: 600; }
        .progress-bar { width: 200px; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: #48bb78; border-radius: 4px; transition: width 0.3s ease; }
        .progress-text { font-size: 0.9rem; margin-top: 5px; }
        .topic-category { margin-bottom: 20px; }
        .category-title { font-size: 1.1rem; font-weight: 500; color: #4a5568; margin-bottom: 10px; padding: 8px 12px; background: #f7fafc; border-radius: 6px; }
        .topic-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 8px; transition: all 0.2s ease; }
        .topic-item:hover { background: #f8f9fa; border-color: #cbd5e0; }
        .topic-name { font-weight: 500; color: #2d3748; }
        .topic-description { font-size: 0.85rem; color: #718096; margin-top: 4px; }
        .topic-controls { display: flex; align-items: center; gap: 10px; }
        .status-btn { width: 25px; height: 25px; border: none; border-radius: 50%; cursor: pointer; transition: transform 0.2s ease; font-size: 12px; }
        .status-btn:hover { transform: scale(1.1); }
        .status-not-started { background: #e2e8f0; border: 2px solid #cbd5e0; }
        .status-in-progress { background: #fbd38d; color: white; }
        .status-practicing { background: #63b3ed; color: white; }
        .status-mastered { background: #68d391; color: white; }
        .practice-btn, .framework-btn { padding: 6px 12px; color: white; border: none; border-radius: 6px; font-size: 0.8rem; cursor: pointer; transition: background 0.2s ease; }
        .practice-btn { background: #805ad5; }
        .practice-btn:hover { background: #6b46c1; }
        .framework-btn { background: #3182ce; }
        .framework-btn:hover { background: #2c5282; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s ease; }
        .modal-content { background-color: white; margin: 5% auto; padding: 2rem; border-radius: 10px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto; position: relative; }
        .close { color: #aaa; position: absolute; right: 1rem; top: 1rem; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: #000; }
        .clm-section { background: #f8f9fa; padding: 1rem; border-radius: 5px; margin: 1rem 0; border-left: 4px solid #3498db; }
        .clm-letter { font-weight: bold; color: #e74c3c; font-size: 1.2rem; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .subject-toggle { display: flex; gap: 10px; margin-bottom: 20px; }
        .toggle-btn { flex: 1; padding: 10px; border: 1px solid #cbd5e0; border-radius: 8px; background-color: #f7fafc; cursor: pointer; font-weight: 500; transition: all 0.2s ease; }
        .toggle-btn.active { background-color: #3182ce; color: white; border-color: #3182ce; }
        .loading-text, .error-text { text-align: center; color: #718096; padding: 20px; background: #f7fafc; border-radius: 8px; }
        .error-text { background: #fed7d7; color: #c53030; }
        .heatmap { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 5px; }
        .heatmap-cell { padding: 0.5rem; font-size: 0.8rem; text-align: center; border-radius: 5px; color: white; font-weight: 500; }
        .heat-high { background: #48bb78; } .heat-medium { background: #ed8936; } .heat-low { background: #e53e3e; }
        .suggestion-box { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; margin-top: 20px; }
        .suggestion-text { font-style: italic; line-height: 1.6; }
        .goals-progress { display: grid; gap: 15px; margin-bottom: 20px; }
        .progress-item .progress-bar { height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-top: 5px; }
        .progress-item .progress-fill { height: 100%; transition: width 0.5s ease; }
        .progress-item .progress-fill-chem { background: #fbbf24; }
        .progress-item .progress-fill-phys { background: #3b82f6; }
        .progress-label { font-size: 0.9rem; font-weight: 500; display: flex; justify-content: space-between; }
        .goals-today { margin-top: 20px; padding-top: 20px; border-top: 1px solid #f1f5f9; }
        .today-title { font-weight: 600; text-align: center; margin-bottom: 15px; font-size: 1.1em; color: #4a5568;}
        .today-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .today-task-list { list-style: none; padding-left: 5px; }
        .today-task-item { font-size: 0.85rem; margin-bottom: 8px; display: flex; align-items: flex-start; line-height: 1.4; }
        .today-task-item::before { content: '☐'; margin-right: 8px; font-family: monospace; color: #9ca3af; margin-top: 2px; }
        .today-task-item.completed::before { content: '✅'; }
        .today-task-item.completed { text-decoration: line-through; opacity: 0.7; }
        .goals-actions { margin-top: 25px; display: flex; gap: 10px; justify-content: center; }
        .action-link { padding: 10px 20px; text-decoration: none; border-radius: 20px; font-weight: 500; font-size: 0.9rem; transition: all 0.2s ease; }
        .action-link-chem { background: #fef3c7; color: #92400e; border: 1px solid #fbbf24; }
        .action-link-phys { background: #dbeafe; color: #1e40af; border: 1px solid #3b82f6; }
        .action-link:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        @media (max-width: 992px) { .dashboard { grid-template-columns: 1fr; } }
          /* 状态图例容器 */
.status-legend {
    display: flex;
    flex-wrap: wrap; /* 在小屏幕上允许换行 */
    gap: 20px;       /* 图例项之间的间距 */
    align-items: center;
    margin-bottom: 25px;
    padding: 12px 20px;
    background-color: #f7fafc;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
}

/* 单个图例项 (圆圈 + 文字) */
.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;       /* 圆圈和文字之间的间距 */
    font-size: 0.9em;
    color: #4a5568;
}

/* 模拟的状态按钮 (圆形) */
.status-btn-mock {
    /* 完全复制 .status-btn 的核心样式 */
    width: 25px;
    height: 25px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    color: white; /* 默认文字颜色 */
}

/* 我们复用已有的状态颜色类，无需额外代码。
   但为了确保边框不影响大小，为 not-started 单独加一个属性 */
.status-btn-mock.status-not-started {
    box-sizing: border-box; 
}
    </style>
</head>
<body>
    <div class="container">
        <!-- 核心修改点：在 Header 中增加一个跳转按钮 -->
        <div class="header">
    <h1>🎯 Combined Science 「 Chemistry & Physics」</h1>
    <p>Intelligent Learning Dashboard - Track Your Progress & Master Your Goals</p>
    <a href="strategic-planner.html" class="planner-link">🚀 Go to Strategic Planner</a>
    <a href="chemistry-sprint-guide.html" class="planner-link">🧪 Start Chemistry Sprint</a>
    <a href="physics-atomic-note.html" class="planner-link">📒 Atomic Note</a>  
    <a href="phys-knowledge-matrix.html" class="planner-link">♚ Phys Knowledge Matrix</a>  
    <a href="chemistry-final-sprint.html" class="planner-link" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: 1px solid rgba(255, 255, 255, 0.6);">⚔️ Final 4-Hour Battle Plan</a>
</div>
     <div class="dashboard">
    <!-- ======================= 左侧主面板 START ======================= -->
    <div class="main-panel">
        <h2 class="section-title">📚 Study Path & Progress Tracking</h2>

        <!-- 状态图例 -->
        <div class="status-legend">
            <div class="legend-item">
                <div class="status-btn-mock status-not-started"></div>
                <span>Not Started</span>
            </div>
            <div class="legend-item">
                <div class="status-btn-mock status-in-progress">●</div>
                <span>In Progress</span>
            </div>
            <div class="legend-item">
                <div class="status-btn-mock status-practicing">P</div>
                <span>Practicing</span>
            </div>
            <div class="legend-item">
                <div class="status-btn-mock status-mastered">✓</div>
                <span>Mastered</span>
            </div>
        </div>

        <!-- Chemistry Section START -->
        <div class="subject-section" id="chemistry-section">
            <div class="subject-header">
                <div class="subject-title">🧪 Chemistry</div>
                <div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">Mastered: 0 / 9</div>
                </div>
            </div>
            <div class="topic-category">
                <div class="category-title">🎯 Core Topics (81% of marks)</div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Acids, Bases & Salts / QA</div>
                        <div class="topic-description">The most comprehensive and highest-weighted topic</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('qa-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/13kkgejzhLaRmPElxBktaZJMb-cLDHufqvrKdJwkAroY/edit?usp=sharing', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Stoichiometry & The Mole Concept</div>
                        <div class="topic-description">The most calculation-intensive and procedural topic</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('stoichiometry-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1GAjOG7i8Ay9W3235LWwtbg2A6p2z0Y8me81PPjTQM8w/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Chemical Bonding & Structure</div>
                        <div class="topic-description">A major source of explanation and diagram-based questions</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('bonding-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1XBwPW4yl52IaxJlyxEcT01l_l-IgnUi-4Nb75flZ_tU/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Redox Reactions & Reactivity of Metals</div>
                        <div class="topic-description">The core of logical reasoning and prediction questions</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('redox-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1teFXYmCtshBsCw5CFhBxQ0jT_ItYpYD13-gPw7RlIPg/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
            </div>
            <div class="topic-category">
                <div class="category-title">🛰️ Satellite Topics (19% of marks)</div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Experimental Chemistry</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('experimental-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/182GL6T_h1hQn_uRYqTTaL3hzUrxhwh0s-S2QxUlsuu4/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">The Particulate Nature of Matter</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('matter-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1fD4a29M5m1twBNMmCd8JwaVC14aXTGrkZza0d5BvOJ8/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Atomic Structure</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('atomic-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1oNBuqDYOpI3GW6WSHaE8ixxhc9D0SgSsMwQpmgLWVZw/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">The Periodic Table</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('periodic-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1jAxaZeswXrmMJXtjuMMFI9ne4KJ8G3KoJ7CQm6ZbFHY/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Air & The Environment</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showChemistryFramework('environment-framework')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1ZBnhucfdNPcZjb5LaEKfh9ZFwRzTEKFLxl85ioguSLc/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
            </div>
        </div>
        <!-- Chemistry Section END -->

        <!-- Physics Section START -->
        <div class="subject-section" id="physics-section">
            <div class="subject-header">
                <div class="subject-title">⚡ Physics</div>
                <div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">Mastered: 0 / 9</div>
                </div>
            </div>
            <div class="topic-category">
                <div class="category-title">🎯 Core Archetypes (The "Big Five")</div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">The Kinematics Graph Saga</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('kinematics')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1qDLUzRLwvqSofKnvvQbD2DoKtdX_tkP73-UL4i9BcKY/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">The Balancing Act (Moments & Equilibrium)</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('equilibrium')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1Xdh3DoB2UjPHIGpL4vcTRR5AGHxwCocTvN5fsrYtH7U/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">The Energy Conversion Trail</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('energy')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1hre1cJO-ya60dBkteMFe2quBY8Ac3hRAQP9efveVdbI/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">The Particle Storytelling (Thermal Physics)</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('thermal')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1z7UGZ71aNo57NG5Q-m384KA2_YmLnCPybPTzKipriYQ/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Circuit Analysis Saga</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('circuit')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1HcjVrf50xCtg9KZw_O_PK72zf_WWvnTfjSwSzzqlPJA/edit?usp=sharing', '_blank')">Practice</button></div>
                </div>
            </div>
            <div class="topic-category">
                <div class="category-title">🛰️ Satellite Archetypes</div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Stability (Centre of Gravity & Base Area)</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('stability')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1zUDZD90Lge9KdqCkgA7SPIWc2w0qKgK2puRUvSNzRpY/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Vector Drawing & Dynamics</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="framework-btn" onclick="showFramework('equilibrium')">🧠</button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1y2e3CKutRQVF8krx5HH_VNgmaPPHYvqKzpi-3srC-bo/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Density & Pressure Calculation</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1c3yPKiqNiW3ayzNwO8jXOaCETFGCEa-9MFQXo85vGws/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
                <div class="topic-item">
                    <div>
                        <div class="topic-name">Light Ray Tracing & Optics Calculation</div>
                    </div>
                    <div class="topic-controls"><button class="status-btn status-not-started" title="Not Started"></button><button class="practice-btn" onclick="window.open('https://docs.google.com/document/d/1JbXc39hdg7e0liPzMd0fQMUY92tWn0tmu17wqfEKaPA/edit?usp=drive_link', '_blank')">Practice</button></div>
                </div>
            </div>
        </div>
        <!-- Physics Section END -->

    </div>
    <!-- ======================= 左侧主面板 END (这个 </div> 的位置至关重要！) ======================= -->

    <!-- ======================= 右侧边栏 START ======================= -->
    <div class="side-panel">
        <div class="widget" id="strengths-widget">
            <h3 class="section-title">📊 Strengths & Weaknesses</h3>
            <div class="subject-toggle"><button class="toggle-btn active" onclick="updateAnalytics('Chemistry')">🧪 Chemistry</button><button class="toggle-btn" onclick="updateAnalytics('Physics')">⚡ Physics</button></div>
            <div id="analytics-content">
                <div id="loading-analytics" class="loading-text">Loading analytics data...</div>
            </div>
        </div>
        <div class="widget">
            <h3 class="section-title">🎯 This Week's Sprint Goals</h3>
            <div id="goals-module-content">
                <p class="loading-text">Loading weekly goals...</p>
            </div>
        </div>
    </div>
    <!-- ======================= 右侧边栏 END ======================= -->
</div>
        
    <div id="frameworkModal" class="modal"><div class="modal-content"><span class="close" onclick="closeFramework()">&times;</span><div id="frameworkDetails"></div></div></div>
    <script>
        // --- 1. FIREBASE CONFIGURATION & INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDdtQYfOC87IvpTZPFoDyb6ZgpEISzqw_I",
            authDomain: "emath-study-plan.firebaseapp.com",
            projectId: "emath-study-plan",
            storageBucket: "emath-study-plan.firebasestorage.app",
            messagingSenderId: "589299697460",
            appId: "1:589299697460:web:df1e0bb0586b3740c04761",
            measurementId: "G-09QVE4GLS0"
        };
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- 2. GLOBAL VARIABLES ---
        let skillRadarChart;
        let chemSprintTasks = [], physSprintTasks = [];
        // +++ 新增代码 +++
        const API_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzUoTqJwi6761U6VaMdJmUa9y5s8AATnr6iW6A-cb3q8iilbWCFdepDRB-auD160tNh/exec';
        let errorLogData = {}; // 用于存储从 Google Sheet 获取的最新错题数据

         // --- 3. INITIALIZATION & EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await fetchAllData(); // 调用新的总数据获取函数
                
                // 渲染所有模块
                updateAnalytics('Chemistry'); // 这个函数现在会直接使用 science-data.js 的数据
                renderGoalsModule();
                updateAllProgress(); 
            } catch (error) {
                console.error("Error during initial module rendering:", error);
            }

            // --- 状态按钮激活逻辑 ---
            const mainPanel = document.querySelector('.main-panel');
            if (mainPanel) {
                mainPanel.addEventListener('click', function(e) {
                    if (e.target.classList.contains('status-btn')) {
                        const statuses = ['status-not-started', 'status-in-progress', 'status-practicing', 'status-mastered'];
                        const titles = ['Not Started', 'In Progress', 'Practicing', 'Mastered'];
                        const symbols = ['', '●', 'P', '✓'];
                        
                        let currentIndex = statuses.findIndex(status => e.target.classList.contains(status));
                        const nextIndex = (currentIndex + 1) % statuses.length;
                        
                        e.target.className = 'status-btn'; // 重置类
                        e.target.classList.add(statuses[nextIndex]);
                        e.target.title = titles[nextIndex];
                        e.target.textContent = symbols[nextIndex];

                        // 每次点击后，重新计算进度条
                        updateAllProgress();
                    }
                });
            }
        });
        
        // --- 4. DATA FETCHING ---

// 辅助函数：从 Firebase 获取 Sprint 任务
async function fetchSprintTasksFromDB(docId) {
    try {
        const doc = await db.collection("sprintPlan").doc(docId).get();
        return doc.exists ? (doc.data().allTasks || []) : [];
    } catch (error) {
        console.error(`Error fetching tasks from ${docId}:`, error);
        return [];
    }
}

// 辅助函数：从 Google Apps Script API 获取错题数据
async function fetchErrorLogFromAPI(sheetName) {
    try {
        // 附加时间戳参数以强制绕过缓存
        const url = `${API_ENDPOINT}?sheet=${sheetName}&t=${new Date().getTime()}`;
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`API request failed for ${sheetName} with status ${response.status}`);
        }
 // 关键修复点：解析JSON后，提取其中的 "rows" 数组        
        const result = await response.json(); 
        return result.rows || []; 
        // 提取 "rows" 属性，如果不存在则返回空数组以防出错
    } catch (error) {
        console.error(`Error fetching error log for ${sheetName}:`, error);
        return []; // 出错时返回空数组
    }
}

// 主函数：并行获取所有数据
async function fetchAllData() {
    try {
        const [chemTasks, physTasks, chemErrors, physErrors] = await Promise.all([
            fetchSprintTasksFromDB('chemistry_tasks_v1'),
            fetchSprintTasksFromDB('physics_tasks_v1'),
            fetchErrorLogFromAPI('Chemistry'),
            fetchErrorLogFromAPI('Physics')
        ]);

        // 将获取到的数据存入全局变量
        chemSprintTasks = chemTasks;
        physSprintTasks = physTasks;
        errorLogData = {
            'Chemistry': chemErrors,
            'Physics': physErrors
        };
        
     // +++ 在这里添加下面这行代码 +++
    console.log("Final data received from API:", errorLogData);
        
    } catch (error) {
        console.error("An error occurred during parallel data fetching:", error);
        // 可以在此处添加UI提示，告知用户数据加载失败
    }
}

                // --- 5. ANALYTICS MODULE (Strengths & Weaknesses) ---
        window.updateAnalytics = function(subject) {
            document.querySelectorAll('.toggle-btn').forEach(btn => { 
                btn.classList.toggle('active', btn.textContent.includes(subject)); 
            });

            // 核心修复点：确保它从正确的全局变量 scienceData 中读取数据
            const subjectData = errorLogData[subject] || [];
            const analyticsContent = document.getElementById('analytics-content');
            if (!analyticsContent) return;

            // 新的提示
            if (!subjectData || subjectData.length === 0) {
            analyticsContent.innerHTML = `<div class="loading-text" style="background: #e6e8ff; color: #667eea;">No practice data found for ${subject}. Please update the Google Sheet.</div>`;
            return;
            }
            analyticsContent.innerHTML = `<canvas id="skillRadarChart" style="max-height: 250px;"></canvas><h4 id="heatmap-title" style="margin: 15px 0 10px 0; color: #4a5568;">Knowledge Heatmap</h4><div id="heatmap-container" class="heatmap"></div><div id="suggestion-box-container" class="suggestion-box"><div id="suggestion-text" class="suggestion-text"></div></div>`;
            
            const incorrectData = subjectData.filter(item => item.result === 'Incorrect');
            const errorTypes = subject === 'Chemistry' ? ['M-Error', 'P-Error', 'C-Error', 'Q-Error', 'L-Error'] : ['C1', 'P1', 'P2', 'P3', 'C2', 'M1'];
            const errorCounts = errorTypes.map(type => 
               incorrectData.filter(item => item.errortype && item.errortype.startsWith(type)).length
            );
            const totalErrors = incorrectData.length || 1;
            const skillScores = errorCounts.map(count => Math.max(0, 100 - (count / totalErrors * 100)));
            
            renderRadarChart(errorTypes.map(e => e.split('(')[0].trim()), skillScores);

            const topicPerformance = {};
            const allTopics = [...new Set(subjectData.map(item => item.topic))].filter(Boolean);
            allTopics.forEach(topic => { 
               const items = subjectData.filter(item => item.topic === topic); 
               const correct = items.filter(item => item.result === 'Correct').length; 
               const partial = items.filter(item => item.result === 'Partial').length; 
               if (items.length > 0) topicPerformance[topic] = ((correct + (partial * 0.5)) / items.length) * 100; 
            });
            renderHeatmap(topicPerformance);
            generateSuggestion(topicPerformance, errorCounts, errorTypes);
        }

        function renderRadarChart(labels, scores) { 
            const ctx = document.getElementById('skillRadarChart').getContext('2d'); 
            if (skillRadarChart) skillRadarChart.destroy(); 
            skillRadarChart = new Chart(ctx, { 
                type: 'radar', 
                data: { 
                    labels: labels, 
                    datasets: [{ 
                        label: 'Skill Score', 
                        data: scores, 
                        fill: true, 
                        backgroundColor: 'rgba(52, 152, 219, 0.2)', 
                        borderColor: 'rgb(52, 152, 219)', 
                        pointBackgroundColor: 'rgb(52, 152, 219)', 
                    }] 
                }, 
                options: { 
                    scales: { 
                        r: { 
                            suggestedMin: 0, 
                            suggestedMax: 100, 
                            pointLabels: { font: { size: 12 } } 
                        } 
                    }, 
                    plugins: { legend: { display: false } } 
                } 
            }); 
        }

        function renderHeatmap(d) { 
            const c = document.getElementById('heatmap-container'); 
            c.innerHTML = ''; 
            const s = Object.keys(d).sort((a,b) => d[a] - d[b]); 
            s.forEach(t => { 
                const score = d[t]; 
                let h = 'heat-low'; 
                if (score >= 85) h = 'heat-high'; 
                else if (score >= 60) h = 'heat-medium'; 
                const cell = document.createElement('div'); 
                cell.className = `heatmap-cell ${h}`; 
                cell.textContent = t.length > 12 ? t.substring(0, 10) + '...' : t; 
                cell.title = `${t}: ${score.toFixed(0)}% Correct`; 
                c.appendChild(cell); 
            }); 
        }
        
        function generateSuggestion(topicPerf, errorCounts, errorTypes) { 
            const el = document.getElementById('suggestion-text'); 
            const totalErrors = errorCounts.reduce((s, c) => s + c, 0); 
            if (totalErrors === 0) { 
                const p = Object.keys(topicPerf).filter(t => topicPerf[t] < 100); 
                if (p.length > 0) el.innerHTML = `🎉 Excellent! No incorrect answers. Focus on mastering partially correct topics like <strong>"${p[0]}"</strong> to achieve perfection!`; 
                else el.innerHTML = "🏆 Outstanding performance! All topics are well-mastered."; 
                return; 
            } 
            let wT = null, lS = 101; 
            Object.keys(topicPerf).forEach(t => { if(topicPerf[t] < lS){ lS = topicPerf[t]; wT = t; } }); 
            let mE = -1, mET = null; 
            errorCounts.forEach((c, i) => { if(c > mE){ mE = c; mET = errorTypes[i]; } }); 
            if (wT && mET) el.innerHTML = `💡 Your weakest area is <strong>"${wT}"</strong> (Accuracy ${lS.toFixed(0)}%). The most common error type is <strong>"${mET}"</strong>. I recommend reviewing this topic's framework and doing targeted practice.`; 
            else el.innerHTML = "Analysis complete. Use the charts above to guide your study plan."; 
        }
        // --- 6. GOALS MODULE ---
        function renderGoalsModule() {
            const container = document.getElementById('goals-module-content');
            if (!container) return;
            
            const chemStats = calculateSprintStats(chemSprintTasks);
            const physStats = calculateSprintStats(physSprintTasks);
            
            container.innerHTML = `
                <div class="goals-progress">
                    <div class="progress-item"><div class="progress-label"><span>🧪 Chemistry Sprint</span><span>${chemStats.completed} / ${chemStats.total} Done</span></div><div class="progress-bar"><div class="progress-fill progress-fill-chem" style="width: ${chemStats.percentage}%;"></div></div></div>
                    <div class="progress-item"><div class="progress-label"><span>⚡ Physics Sprint</span><span>${physStats.completed} / ${physStats.total} Done</span></div><div class="progress-bar"><div class="progress-fill progress-fill-phys" style="width: ${physStats.percentage}%;"></div></div></div>
                </div>
                <div class="goals-today"><div class="today-title">Today's Focus</div><div class="today-columns"><div><h4 style="text-align:center; margin-bottom:10px;">Chemistry</h4><ul class="today-task-list">${generateTodayTaskList(chemSprintTasks, 'Chemistry')}</ul></div><div><h4 style="text-align:center; margin-bottom:10px;">Physics</h4><ul class="today-task-list">${generateTodayTaskList(physSprintTasks, 'Physics')}</ul></div></div></div>
                <div class="goals-actions"><a href="chemistry-sprint-guide.html" class="action-link action-link-chem">Go to Chem Sprint</a><a href="#" class="action-link action-link-phys" style="opacity:0.5; cursor:not-allowed;" title="Coming Soon">Go to Phys Sprint</a></div>`;
        }
        function calculateSprintStats(tasks) { const t = tasks.length; if (t === 0) return { total: 0, completed: 0, percentage: 0 }; const c = tasks.filter(task => task.checked === true).length; return { total: t, completed: c, percentage: (c / t) * 100 }; }
        function generateTodayTaskList(tasks, subject) {
            if (!tasks || tasks.length === 0) return `<li>No ${subject} sprint plan active.</li>`;
            const today = new Date().toLocaleDateString('en-US', { weekday: 'short' });
            const todayTasks = tasks.filter(task => task.day && task.day.toLowerCase().startsWith(today.toLowerCase()));
            if (todayTasks.length === 0) return `<li>No tasks for today.</li>`;
            return todayTasks.map(task => `<li class="today-task-item ${task.checked ? 'completed' : ''}">${task.mission}</li>`).join('');
        }

               // --- 7. FRAMEWORK FUNCTIONS (COMPLETE & RESTORED) ---
        window.closeFramework = function() { document.getElementById('frameworkModal').style.display = 'none'; }
        window.onclick = function(event) { if (event.target == document.getElementById('frameworkModal')) { closeFramework(); } }
        
        window.showChemistryFramework = function(frameworkType) {
            const modal = document.getElementById('frameworkModal');
            const details = document.getElementById('frameworkDetails');
            const chemistryFrameworks = {
                'qa-framework': `<h2>Acids, Bases & Salts / QA Framework</h2><h3>Model Emphasis: C → L (Connect → Link), supported by M (Manipulate)</h3><div class="clm-section"><h4><span class="clm-letter">C (Connect):</span> Crucial</h4><p>Connect descriptive words (green solution, gas turns limewater cloudy, white precipitate) to your memorised database of specific ions or substances (Fe²⁺, CO₂, AgCl).</p><p>Connect the task "prepare an insoluble salt" to the reaction type "Precipitation".</p></div><div class="clm-section"><h4><span class="clm-letter">M (Manipulate):</span></h4><p>Manipulate chemical symbols to write and balance full and ionic equations correctly.</p></div><div class="clm-section"><h4><span class="clm-letter">L (Link):</span></h4><p>Link the observations from multiple experimental steps to construct a complete logical chain for deducing an unknown substance (in QA flowcharts).</p><p>Link the microscopic rule (salt solubility) to the macroscopic decision (choice of preparation method).</p></div>`,
                'stoichiometry-framework': `<h2>Stoichiometry & Mole Concept Framework</h2><h3>Model Emphasis: C → M (Connect → Manipulate)</h3><div class="clm-section"><h4><span class="clm-letter">C (Connect):</span></h4><p>Connect the numerical values in the question (50.0 cm³, 2.00 mol/dm³) to their corresponding physical quantity symbols (V, C).</p><p>Connect the required answer "mass" to the final formula needed, m = n × M.</p></div><div class="clm-section"><h4><span class="clm-letter">M (Manipulate):</span> Crucial</h4><p>Manipulate the mole-triangle formulas for unit conversion and calculation.</p><p>Manipulate balanced chemical equations to extract the mole ratio.</p><p>Manipulate the limiting reactant identification procedure. This is the most procedural part of the topic.</p></div><div class="clm-section"><h4><span class="clm-letter">L (Link):</span></h4><p>(Less emphasized) Occasionally required to link a calculation result to its real-world meaning, such as explaining why one reactant was used in excess.</p></div>`,
                'bonding-framework': `<h2>Chemical Bonding & Structure Framework</h2><h3>Model Emphasis: C → L (Connect → Link), supported by M (Manipulate)</h3><div class="clm-section"><h4><span class="clm-letter">C (Connect):</span></h4><p>Connect the substance name (sodium chloride) to its bonding type (metal + non-metal → Ionic).</p><p>Connect the question "explain high melting point" to the corresponding explanation model.</p></div><div class="clm-section"><h4><span class="clm-letter">M (Manipulate):</span></h4><p>Manipulate electron arrangement rules to accurately construct dot-and-cross diagrams.</p></div><div class="clm-section"><h4><span class="clm-letter">L (Link):</span> Crucial</h4><p>Link the microscopic structure (Giant Ionic Lattice) and forces (strong electrostatic forces) to macroscopic physical properties (high melting point, conducts electricity when molten). This is the core of all explanation questions in this topic.</p></div>`,
                'redox-framework': `<h2>Redox Reactions & Reactivity Framework</h2><h3>Model Emphasis: C → L (Connect → Link)</h3><div class="clm-section"><h4><span class="clm-letter">C (Connect):</span></h4><p>Connect the reactant combination (Zn + CuSO₄) to the "Displacement Reaction" type.</p><p>Connect a real-world context ("preventing rust on a ship") to the application of the "Reactivity Series" or "Sacrificial Protection".</p></div><div class="clm-section"><h4><span class="clm-letter">M (Manipulate):</span></h4><p>(Less emphasized) Occasionally required to manipulate half-equations.</p></div><div class="clm-section"><h4><span class="clm-letter">L (Link):</span> Crucial</h4><p>Link an element's position in the reactivity series (a rule) to whether a reaction will occur (a prediction).</p><p>Link the microscopic meaning of "more reactive" (easier to lose electrons) to the macroscopic outcome (Zn is preferentially oxidised).</p></div>`,
                'experimental-framework': `<h2>Experimental Chemistry Framework</h2><h3>Model Emphasis: C → L (Connect → Link)</h3><div class="clm-section"><p>Connect the state of the mixture (e.g., insoluble solid in liquid) to a specific separation technique (e.g., Filtration). Link the choice of technique (e.g., Fractional Distillation) to differences in the substances' physical properties (e.g., different boiling points).</p></div>`,
                'matter-framework': `<h2>Particulate Nature of Matter Framework</h2><h3>Model Emphasis: L (Link)</h3><div class="clm-section"><p>Link the microscopic particle behavior (gain in kinetic energy, overcoming forces of attraction) to macroscopic changes of state (melting, boiling). Your explanation must describe the particles.</p></div>`,
                'atomic-framework': `<h2>Atomic Structure Framework</h2><h3>Model Emphasis: C → M (Connect → Manipulate)</h3><div class="clm-section"><p>Connect symbols (e.g., ²⁴₁₂Mg²⁺) to its constituent parts (A=24, Z=12, charge=+2). Manipulate formulas (n⁰ = A - Z) to calculate the number of particles and write electronic configurations.</p></div>`,
                'periodic-framework': `<h2>The Periodic Table Framework</h2><h3>Model Emphasis: C → L (Connect → Link)</h3><div class="clm-section"><p>Link an element's position (Group/Period) to its atomic structure (e.g., number of valence electrons) and then link that structure to its chemical properties and trends down a group or across a period.</p></div>`,
                'environment-framework': `<h2>Air & The Environment Framework</h2><h3>Model Emphasis: C (Connect)</h3><div class="clm-section"><p>This topic is heavy on memory and association. Your primary task is to connect pollutants (e.g. SO₂) to their sources (e.g. burning fossil fuels) and their resulting environmental problems (e.g. acid rain).</p></div>`
            };
            details.innerHTML = chemistryFrameworks[frameworkType] || '<h2>Framework details not found</h2>';
            modal.style.display = 'block';
        }

         window.showFramework = function(frameworkType) {
            const modal = document.getElementById('frameworkModal');
            const details = document.getElementById('frameworkDetails');
            const frameworks = {
                // ✅ 新增的 Circuit Analysis 框架
                'circuit': `<h2>Circuit Analysis Saga Framework</h2>
                            <h3>Core Models: R-I-V Logic & R-V-I-P Chain</h3>
                            <p>This saga uses two key models: one for reasoning about changes (qualitative) and one for precise calculations (quantitative).</p>
                            <div class="clm-section">
                                <h4><span class="clm-letter">Model 1:</span> The R-I-V Logic Chain (For Explanation)</h4>
                                <p><strong>Purpose:</strong> To explain what happens when a change is made to a circuit (e.g., "What happens to the brightness of bulb X if switch Y is closed?").</p>
                                <p><strong>Method:</strong>
                                    <br>1. <strong>Resistance (R):</strong> Start by stating how the change affects the <strong>total resistance</strong> of the circuit. <em>(e.g., "Closing the switch adds a parallel branch, so the total effective resistance of the circuit decreases.")</em>
                                    <br>2. <strong>Current (I):</strong> Link the change in total resistance to the <strong>total current</strong> from the battery using Ohm's Law. <em>(e.g., "Since the EMF of the battery is constant, a decrease in total resistance causes the total current to increase.")</em>
                                    <br>3. <strong>Voltage/Current (V/I):</strong> Trace how this change in total current affects the specific component in question, considering how voltage and current are distributed in series and parallel parts. <em>(e.g., "This increased total current now splits, and you must analyze how the potential divider rule applies to determine the change in voltage across bulb X.")</em>
                                </p>
                            </div>
                            <div class="clm-section">
                                <h4><span class="clm-letter">Model 2:</span> The R-V-I-P Calculation Chain (For Calculation)</h4>
                                <p><strong>Purpose:</strong> To systematically calculate any unknown value (Resistance, Voltage, Current, Power) in the circuit.</p>
                                <p><strong>Method:</strong>
                                    <br>1. <strong>Find Total Resistance (R):</strong> Systematically combine series (R₁ + R₂) and parallel (1/R₁ + 1/R₂) resistors until you find the single total effective resistance of the circuit.
                                    <br>2. <strong>Find Total Current (V → I):</strong> Use the total voltage (EMF) and total resistance with <strong>V = IR</strong> to find the total current leaving the battery.
                                    <br>3. <strong>Distribute V & I:</strong> Work backwards from the total current, applying two simple rules:
                                    <br>   - In <strong>Series</strong>: Current is the same, Voltage splits.
                                    <br>   - In <strong>Parallel</strong>: Voltage is the same, Current splits.
                                    <br>4. <strong>Calculate Power (P):</strong> Once you know the specific V and I for any component, use <strong>P = VI</strong> to find its power.
                                </p>
                            </div>`,
                'thermal': `<h2>Thermal Physics Explanation Framework</h2><h3>Model Name: The M-C-E (Micro-Cause-Effect) Chain</h3><div class="clm-section"><h4><span class="clm-letter">M (Micro-level):</span> Energy Change</h4><p>Describe the change in the particles' Kinetic Energy (KE) or Potential Energy (PE).</p><p><strong>Trigger Phrases:</strong> "Particles gain/lose KE...", "Energy is absorbed to overcome forces of attraction..."</p></div><div class="clm-section"><h4><span class="clm-letter">C (Cause):</span> Particle Behaviour</h4><p>Describe how the energy change alters the motion, spacing, or arrangement of the particles.</p><p><strong>For Convection:</strong> Must include Density Change! [Gains heat] → [Expands] → [Becomes less dense] → [Rises]</p></div><div class="clm-section"><h4><span class="clm-letter">E (Effect):</span> Macro-level Phenomenon</h4><p>Link the change in particle behaviour to the macroscopic phenomenon.</p></div>`,
                'kinematics': `<h2>Kinematics Graph Narrative Framework</h2><h3>Model Name: The G-S-V (Gradient-Shape-Value) Storyboard</h3><div class="clm-section"><h4><span class="clm-letter">G (Gradient's Meaning):</span></h4><p>State the physical meaning of the gradient (e.g., "The gradient of the v-t graph represents acceleration.")</p></div><div class="clm-section"><h4><span class="clm-letter">S (Shape's Meaning):</span></h4><p>Translate the shape of the graph line into a description of the motion (e.g., "...a straight line, indicating constant acceleration.")</p></div><div class="clm-section"><h4><span class="clm-letter">V (Key Values):</span></h4><p>Include specific numerical values for time, speed, or calculated acceleration.</p></div>`,
                'equilibrium': `<h2>Force Equilibrium Explanation Framework</h2><h3>Model Name: The N1L (Newton's First Law) Principle</h3><div class="clm-section"><p><strong>1. State the Motion:</strong> "The object is moving at a constant velocity / is at rest."</p></div><div class="clm-section"><p><strong>2. Apply the Law:</strong> "According to Newton's First Law, this implies that the net force on the object is zero."</p></div><div class="clm-section"><p><strong>3. Analyze the Forces:</strong> "Therefore, the forward force must be equal and opposite to the total resistive forces."</p></div>`,
                'stability': `<h2>Stability Comparison Framework</h2><h3>Model Name: The CG-B (Centre of Gravity & Base Area) Principle</h3><div class="clm-section"><p><strong>1. Centre of Gravity (CG) Position:</strong> A lower CG leads to greater stability.</p></div><div class="clm-section"><p><strong>2. Base Area:</strong> A wider base of support leads to greater stability.</p></div><div class="clm-section"><p><strong>Reasoning:</strong> A wider base and lower CG mean the object has to be tilted through a larger angle before its line of action falls outside the base.</p></div>`,
                'energy': `<h2>Energy Transformation Framework</h2><h3>Model Name: The PCE+WD (Principle of Conservation of Energy + Work Done) Flowchart</h3><div class="clm-section"><p><strong>1. State the Principle:</strong> "According to the Principle of Conservation of Energy, energy is converted from one form to another."</p></div><div class="clm-section"><p><strong>2. Identify Main Conversion:</strong> "The primary conversion is from [Initial Energy, e.g., GPE] to [Final Energy, e.g., KE]."</p></div><div class="clm-section"><p><strong>3. Identify Dissipation Path:</strong> "However, work is done against [Resistive Force, e.g., friction]."</p></div><div class="clm-section"><p><strong>4. State Final Destination:</strong> "This converts some mechanical energy into thermal energy and/or sound, which is dissipated."</p></div>`
            };
            details.innerHTML = frameworks[frameworkType] || '<h2>Framework details not found</h2>';
            modal.style.display = 'block';
        }
  // --- 8. PROGRESS BAR UPDATE LOGIC ---
        /**
         * 更新指定学科的进度条和文本
         * @param {string} subjectSectionId - 学科部分的 ID (e.g., 'chemistry-section')
         */
        function updateSubjectProgress(subjectSectionId) {
            const section = document.getElementById(subjectSectionId);
            if (!section) return;

            // 查找该学科下的所有主题项，以获取总数
            const allTopicItems = section.querySelectorAll('.topic-item');
            const totalTopics = allTopicItems.length;

            // 查找所有被标记为 "mastered" 的按钮
            const masteredItems = section.querySelectorAll('.status-btn.status-mastered');
            const masteredCount = masteredItems.length;

            // 计算百分比
            const percentage = totalTopics > 0 ? (masteredCount / totalTopics) * 100 : 0;

            // 获取需要更新的 DOM 元素
            const progressFill = section.querySelector('.progress-fill');
            const progressText = section.querySelector('.progress-text');

            // 更新 UI
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
            if (progressText) {
                progressText.textContent = `Mastered: ${masteredCount} / ${totalTopics}`;
            }
        }

        /**
         * 更新所有学科的进度条
         */
        function updateAllProgress() {
            updateSubjectProgress('chemistry-section');
            updateSubjectProgress('physics-section');
        }    

    </script>
</body>
</html>
