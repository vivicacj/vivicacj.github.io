<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O-level Combined Science Study Planner</title>
    
    <!-- 1. 引入 Firebase SDKs (已补全) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        /* 您的所有 CSS 样式都放在这里，保持不变 */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f4f7f9; min-height: 100vh; padding: 20px; color: #374151; }
        .container { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        /* ... 其他所有 CSS 样式 ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- 模块一：战略规划 (已补全 HTML 容器) -->
        <div class="module">
            <div class="module-header">
                <div class="module-icon icon-strategy">🎯</div>
                <h3 class="module-title">O-level Study Strategy</h3>
            </div>
            <div id="strategy-module-content">
                <p>Loading Strategy...</p>
            </div>
        </div>

        <!-- 模块二：智能复习 (已补全 HTML 容器) -->
        <div class="module">
            <div class="module-header">
                <div class="module-icon icon-review">🔄</div>
                <h3 class="module-title">Smart Review Queue</h3>
            </div>
            <div id="review-module-content">
                <p>Loading Review Queue...</p>
            </div>
        </div>
    </div>

    <script>
    // 使用 IIFE 沙箱确保代码隔离
    (function() {
        // --- 1. 静态数据 (直接内置，不再依赖外部文件) ---
        const examConfig = {
            mainExam: { name: "O-level Combined Science", date: "2025-10-20" },
            schoolTest: { name: "Next School Test (CA2)", date: "2025-08-15" },
            subjects: { Chemistry: { weight: 60 }, Physics: { weight: 40 } },
            topics: {
                "Acids, Bases & Salts / Qualitative Analysis (QA)": { subject: "Chemistry", type: "Core", marks: 15, frequency: "High" },
                "Stoichiometry & The Mole Concept": { subject: "Chemistry", type: "Core", marks: 15, frequency: "High" },
                "Chemical Bonding & Structure": { subject: "Chemistry", type: "Core", marks: 12, frequency: "Medium" },
                "Redox Reactions & Reactivity of Metals": { subject: "Chemistry", type: "Core", marks: 12, frequency: "Medium" },
                "Experimental Chemistry": { subject: "Chemistry", type: "Satellite", marks: 8, frequency: "High" },
                "The Particulate Nature of Matter": { subject: "Chemistry", type: "Satellite", marks: 6, frequency: "Medium" },
                "Atomic Structure": { subject: "Chemistry", type: "Satellite", marks: 4, frequency: "Low" },
                "The Periodic Table": { subject: "Chemistry", type: "Satellite", marks: 4, frequency: "Low" },
                "Air & The Environment": { subject: "Chemistry", type: "Satellite", marks: 4, frequency: "Low" },
                "Organic Chemistry Basics": { subject: "Chemistry", type: "Satellite", marks: 4, frequency: "Low" },
                "The Kinematics Graph Saga": { subject: "Physics", type: "Core", marks: 12, frequency: "High" },
                "The Balancing Act (Moments & Equilibrium)": { subject: "Physics", type: "Core", marks: 12, frequency: "High" },
                "The Energy Conversion Trail": { subject: "Physics", type: "Core", marks: 12, frequency: "Medium" },
                "The Particle Storytelling (Thermal Physics)": { subject: "Physics", type: "Core", marks: 10, frequency: "Medium" },
                "Stability (Centre of Gravity & Base Area)": { subject: "Physics", type: "Satellite", marks: 8, frequency: "Medium" },
                "Vector Drawing & Dynamics": { subject: "Physics", type: "Satellite", marks: 8, frequency: "Medium" },
                "Density & Pressure Calculation": { subject: "Physics", type: "Satellite", marks: 6, frequency: "Low" },
                "Light Ray Tracing & Optics Calculation": { subject: "Physics", type: "Satellite", marks: 6, frequency: "Low" },
                "Electrical Circuits": { subject: "Physics", type: "Core", marks: 12, frequency: "High" },
                "Electromagnetism": { subject: "Physics", type: "Core", marks: 10, frequency: "High" },
                "Forces & Motion": { subject: "Physics", type: "Core", marks: 12, frequency: "High" }
            }
        };

        const scienceData = {
          "Chemistry": [
            { "Subject": "Chemistry", "Topic": "Acids, Bases & Salts / Qualitative Analysis (QA)", "Result": "Incorrect", "Error_Type": "M-Error" },
            { "Subject": "Chemistry", "Topic": "Chemical Bonding & Structure", "Result": "Incorrect", "Error_Type": "P-Error" }
          ],
          "Physics": [
            { "Subject": "Physics", "Topic": "The Kinematics Graph Saga", "Result": "Partial", "Error_Type": "P1" }
          ]
        };

        // --- 2. FIREBASE CONFIGURATION & INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDdtQYfOC87IvpTZPFoDyb6ZgpEISzqw_I",
            authDomain: "emath-study-plan.firebaseapp.com",
            projectId: "emath-study-plan",
            storageBucket: "emath-study-plan.firebasestorage.app",
            messagingSender
