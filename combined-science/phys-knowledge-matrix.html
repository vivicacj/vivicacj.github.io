import React, { useState } from 'react';
import { Book, Zap, Target, AlertCircle, Info } from 'lucide-react';

const PhysicsKnowledgeMatrix = () => {
  const [activeView, setActiveView] = useState('matrix');
  const [hoveredCell, setHoveredCell] = useState(null);
  const [selectedArchetype, setSelectedArchetype] = useState(null);

  const topics = [
    { id: 1, name: 'Measurement', color: 'bg-blue-100 border-blue-300', textColor: 'text-blue-700' },
    { id: 2, name: 'Kinematics', color: 'bg-green-100 border-green-300', textColor: 'text-green-700' },
    { id: 3, name: 'Forces/Dynamics', color: 'bg-purple-100 border-purple-300', textColor: 'text-purple-700' },
    { id: 4, name: 'Moments', color: 'bg-orange-100 border-orange-300', textColor: 'text-orange-700' },
    { id: 5, name: 'Energy/Work/Power', color: 'bg-red-100 border-red-300', textColor: 'text-red-700' },
    { id: 6, name: 'Thermal Physics', color: 'bg-pink-100 border-pink-300', textColor: 'text-pink-700' },
    { id: 7, name: 'Waves & Light', color: 'bg-indigo-100 border-indigo-300', textColor: 'text-indigo-700' },
    { id: 8, name: 'Electricity & Mag.', color: 'bg-yellow-100 border-yellow-300', textColor: 'text-yellow-700' }
  ];

  const archetypes = [
    { 
      id: 'C1', 
      name: 'Kinematics Graph Saga', 
      icon: 'üìä',
      type: 'Core',
      story: 'Reading the story of motion from graphs',
      variations: ['Constant velocity vs acceleration', 'Calculating distance from complex shapes', 'Drawing graphs from description'],
      color: 'bg-cyan-50',
      borderColor: 'border-cyan-300'
    },
    { 
      id: 'C2', 
      name: 'The Balancing Act', 
      icon: '‚öñÔ∏è',
      type: 'Core',
      story: 'Making things not rotate',
      variations: ['Levers: see-saws, cranes', 'Stability on surfaces', 'Toppling point analysis'],
      color: 'bg-yellow-50',
      borderColor: 'border-yellow-300'
    },
    { 
      id: 'C3', 
      name: 'Energy Conversion Trail', 
      icon: '‚ö°',
      type: 'Core',
      story: 'Tracking where the energy goes',
      variations: ['Slopes & ramps', 'Free fall & projectiles', 'Power calculation P=E/t'],
      color: 'bg-pink-50',
      borderColor: 'border-pink-300'
    },
    { 
      id: 'C4', 
      name: 'Particle Storytelling', 
      icon: 'üî¨',
      type: 'Core',
      story: 'Explaining the visible with the invisible',
      variations: ['Heating/cooling curves', 'Heat transfer mechanisms', 'Evaporation cooling effect'],
      color: 'bg-rose-50',
      borderColor: 'border-rose-300'
    },
    { 
      id: 'C5', 
      name: 'Circuit Analysis Saga', 
      icon: 'üîå',
      type: 'Core',
      story: 'Solving the puzzle of electron flow',
      variations: ['Series/parallel resistance', 'V=IR and P=VI calculations', 'Electrical safety analysis'],
      color: 'bg-sky-50',
      borderColor: 'border-sky-300'
    },
    { 
      id: 'S1', 
      name: 'Stability (CG & Base)', 
      icon: 'üèóÔ∏è',
      type: 'Satellite',
      story: 'Why things don\'t fall over',
      variations: ['Comparing stability', 'Loading effects on trucks', 'CG position for equilibrium'],
      color: 'bg-amber-50',
      borderColor: 'border-amber-300'
    },
    { 
      id: 'S2', 
      name: 'Vector Drawing & Dynamics', 
      icon: 'üéØ',
      type: 'Satellite',
      story: 'Finding net result of forces',
      variations: ['Graphical methods', 'Finding acceleration from Fnet=ma', 'Constant velocity scenarios'],
      color: 'bg-lime-50',
      borderColor: 'border-lime-300'
    },
    { 
      id: 'S3', 
      name: 'Density & Pressure Calc', 
      icon: 'üìê',
      type: 'Satellite',
      story: 'Calculating compactness and sharpness',
      variations: ['Pressure under blocks', 'Irregular object density', 'Wide tracks reducing pressure'],
      color: 'bg-teal-50',
      borderColor: 'border-teal-300'
    },
    { 
      id: 'S4', 
      name: 'Light Ray Tracing', 
      icon: 'üí°',
      type: 'Satellite',
      story: 'Following the path of light',
      variations: ['Mirror reflections', 'Refraction & critical angle', 'Lens ray diagrams'],
      color: 'bg-violet-50',
      borderColor: 'border-violet-300'
    }
  ];

  const matrix = {
    '1-C1': { active: true, tools: ['Reading axes', 'Unit analysis'] },
    '2-C1': { active: true, tools: ['Gradient = velocity/acceleration', 'Area = distance', 'suvat equations'] },
    '3-C1': { active: true, tools: ['F=ma explains graph changes', 'Resultant force analysis'] },
    
    '1-C2': { active: true, tools: ['Measuring distances from pivot'] },
    '3-C2': { active: true, tools: ['W=mg for weight calculation'] },
    '4-C2': { active: true, tools: ['Moment = Fd', 'Equilibrium principle'] },
    
    '2-C3': { active: true, tools: ['v¬≤ = u¬≤ + 2as for velocity'] },
    '3-C3': { active: true, tools: ['Friction force Ff', 'Weight component on slope'] },
    '5-C3': { active: true, tools: ['GPE=mgh', 'KE=¬Ωmv¬≤', 'Work=Fd', 'Power=E/t'] },
    
    '5-C4': { active: true, tools: ['Internal energy concepts'] },
    '6-C4': { active: true, tools: ['Kinetic particle model', 'Specific heat capacity', 'Latent heat'] },
    
    '1-C5': { active: true, tools: ['Reading circuit diagrams', 'Ammeter/voltmeter placement'] },
    '8-C5': { active: true, tools: ['V=IR', 'P=VI', 'Series/parallel rules', 'Electrical safety'] },
    
    '3-S1': { active: true, tools: ['Weight = mg'] },
    '4-S1': { active: true, tools: ['Centre of gravity location', 'Stability conditions'] },
    
    '1-S2': { active: true, tools: ['Scalar vs vector', 'Scale drawing'] },
    '2-S2': { active: true, tools: ['a from Fnet=ma'] },
    '3-S2': { active: true, tools: ['Fnet = ma', 'Vector addition', 'Resolving forces'] },
    
    '1-S3': { active: true, tools: ['œÅ=m/V definition', 'P=F/A definition', 'Volume & area calculation'] },
    '3-S3': { active: true, tools: ['Force = Weight (W=mg) for pressure calculation'] },
    
    '1-S4': { active: true, tools: ['Angle measurement', 'Protractor use'] },
    '7-S4': { active: true, tools: ['Law of reflection', 'n=sin i/sin r', 'Lens ray rules'] }
  };

  return (
    <div className="w-full max-w-7xl mx-auto p-6 bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl shadow-lg">
      
      {/* Header */}
      <div className="mb-6">
        <h1 className="text-3xl font-bold text-slate-800 mb-2">Physics 5086: Knowledge Matrix</h1>
        <p className="text-slate-600">One-Page Strategy: Topics (Knowledge Warehouse) √ó Archetypes (Battle SOPs)</p>
      </div>

      {/* View Selector */}
      <div className="mb-8">
        <div className="flex gap-3 flex-wrap">
          <button
            onClick={() => setActiveView('matrix')}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
              activeView === 'matrix' 
                ? 'bg-emerald-600 text-white shadow-md' 
                : 'bg-white text-slate-600 hover:bg-slate-100'
            }`}
          >
            <Target size={18} />
            <span className="font-medium">Matrix View</span>
          </button>
          <button
            onClick={() => setActiveView('warehouse')}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
              activeView === 'warehouse' 
                ? 'bg-blue-600 text-white shadow-md' 
                : 'bg-white text-slate-600 hover:bg-slate-100'
            }`}
          >
            <Book size={18} />
            <span className="font-medium">Warehouse (Topics)</span>
          </button>
          <button
            onClick={() => setActiveView('battlefield')}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
              activeView === 'battlefield' 
                ? 'bg-purple-600 text-white shadow-md' 
                : 'bg-white text-slate-600 hover:bg-slate-100'
            }`}
          >
            <Zap size={18} />
            <span className="font-medium">Battlefield (Archetypes)</span>
          </button>
        </div>
      </div>

      {/* Matrix View */}
      {activeView === 'matrix' && (
        <div className="bg-white rounded-lg p-6 shadow-inner">
          <div className="flex items-start gap-4 mb-6">
            <Target className="text-emerald-600 mt-1 flex-shrink-0" size={24} />
            <div>
              <h3 className="text-xl font-bold text-slate-800">The Integration Map</h3>
              <p className="text-slate-600 text-sm mt-1">Horizontal = Static Knowledge / Vertical = Dynamic Problems / Intersection = Specific Tools</p>
            </div>
          </div>
          
          <div className="overflow-x-auto">
            <table className="w-full border-collapse min-w-max">
              <thead>
                <tr>
                  <th className="border-2 border-slate-300 bg-slate-200 p-3 text-sm font-bold text-slate-700 sticky left-0 z-10">
                    Topics ‚Üì<br/>Archetypes ‚Üí
                  </th>
                  {archetypes.map(arch => (
                    <th key={arch.id} className={`border-2 ${arch.borderColor} ${arch.color} p-3 text-center min-w-[160px]`}>
                      <div className="text-2xl mb-1">{arch.icon}</div>
                      <div className="text-xs font-bold text-slate-800 mb-1">{arch.id}</div>
                      <div className="text-xs font-semibold text-slate-700">{arch.name}</div>
                      <div className="text-xs text-slate-500 mt-1 italic">({arch.type})</div>
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {topics.map(topic => (
                  <tr key={topic.id}>
                    <td className={`border-2 border-slate-300 ${topic.color} p-3 font-bold text-sm ${topic.textColor} sticky left-0 z-10`}>
                      T{topic.id}: {topic.name}
                    </td>
                    {archetypes.map(arch => {
                      const cellKey = `${topic.id}-${arch.id}`;
                      const cellData = matrix[cellKey];
                      return (
                        <td
                          key={cellKey}
                          className={`border-2 border-slate-300 p-2 text-center transition-all ${
                            cellData?.active 
                              ? 'bg-gradient-to-br from-emerald-100 to-emerald-200 cursor-pointer hover:shadow-lg hover:scale-105' 
                              : 'bg-slate-50'
                          }`}
                          onMouseEnter={() => cellData?.active && setHoveredCell(cellKey)}
                          onMouseLeave={() => setHoveredCell(null)}
                        >
                          {cellData?.active && (
                            <div className="relative">
                              <div className="text-2xl font-bold text-emerald-600">‚úì</div>
                              {hoveredCell === cellKey && (
                                <div className="absolute z-20 left-1/2 transform -translate-x-1/2 mt-2 bg-slate-800 text-white text-xs rounded-lg p-3 shadow-xl w-56">
                                  <div className="font-bold mb-2 text-emerald-300">Tools Called:</div>
                                  {cellData.tools.map((tool, idx) => (
                                    <div key={idx} className="mb-1 text-left">‚Ä¢ {tool}</div>
                                  ))}
                                </div>
                              )}
                            </div>
                          )}
                        </td>
                      );
                    })}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <div className="mt-6 grid grid-cols-2 gap-4">
            <div className="p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
              <p className="text-sm text-slate-700">
                <strong className="text-blue-700">Read Horizontally (by row):</strong> One Topic's knowledge serves multiple Archetypes
              </p>
            </div>
            <div className="p-4 bg-purple-50 border-l-4 border-purple-400 rounded">
              <p className="text-sm text-slate-700">
                <strong className="text-purple-700">Read Vertically (by column):</strong> One Archetype calls tools from multiple Topics
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Warehouse View */}
      {activeView === 'warehouse' && (
        <div className="bg-white rounded-lg p-6 shadow-inner">
          <div className="flex items-start gap-4 mb-4">
            <Book className="text-blue-600 mt-1" size={24} />
            <div>
              <h3 className="text-xl font-bold text-slate-800">Knowledge Warehouse: Systematic Learning Architecture</h3>
              <p className="text-slate-600 text-sm mt-1">Build complete knowledge base by chapter sequence (Ensures Input Completeness)</p>
            </div>
          </div>
          <div className="grid grid-cols-3 gap-4 mt-6">
            {topics.map((topic) => (
              <div
                key={topic.id}
                className={`${topic.color} border-2 rounded-lg p-5 transition-transform hover:scale-105 shadow-sm`}
              >
                <div className="text-center">
                  <div className={`text-3xl font-bold ${topic.textColor} mb-2`}>T{topic.id}</div>
                  <div className="text-sm font-semibold text-slate-700 mb-3">{topic.name}</div>
                  <div className="text-xs text-slate-600">
                    Used in {Object.keys(matrix).filter(k => k.startsWith(`${topic.id}-`)).length} Archetypes
                  </div>
                </div>
              </div>
            ))}
          </div>
          <div className="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
            <div className="flex items-start gap-2">
              <AlertCircle className="text-blue-600 mt-0.5" size={18} />
              <p className="text-sm text-slate-700">
                <strong>Purpose:</strong> Ensure zero knowledge gaps. Learn sequentially like building a foundation. Check off each warehouse before moving forward.
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Battlefield View */}
      {activeView === 'battlefield' && (
        <div className="bg-white rounded-lg p-6 shadow-inner">
          <div className="flex items-start gap-4 mb-4">
            <Zap className="text-purple-600 mt-1" size={24} />
            <div>
              <h3 className="text-xl font-bold text-slate-800">Battlefield: Problem-Oriented Battle Plans</h3>
              <p className="text-slate-600 text-sm mt-1">Match question patterns to strategies instantly (Ensures Output Efficiency)</p>
            </div>
          </div>
          
          <div className="mb-4 flex gap-2 flex-wrap">
            <button
              onClick={() => setSelectedArchetype(null)}
              className={`px-3 py-1 rounded text-sm transition-all ${
                selectedArchetype === null 
                  ? 'bg-slate-700 text-white' 
                  : 'bg-slate-200 text-slate-600 hover:bg-slate-300'
              }`}
            >
              All (9)
            </button>
            <button
              onClick={() => setSelectedArchetype('Core')}
              className={`px-3 py-1 rounded text-sm transition-all ${
                selectedArchetype === 'Core' 
                  ? 'bg-purple-600 text-white' 
                  : 'bg-purple-100 text-purple-700 hover:bg-purple-200'
              }`}
            >
              Core (C1-C5)
            </button>
            <button
              onClick={() => setSelectedArchetype('Satellite')}
              className={`px-3 py-1 rounded text-sm transition-all ${
                selectedArchetype === 'Satellite' 
                  ? 'bg-emerald-600 text-white' 
                  : 'bg-emerald-100 text-emerald-700 hover:bg-emerald-200'
              }`}
            >
              Satellite (S1-S4)
            </button>
          </div>

          <div className="space-y-3">
            {archetypes
              .filter(arch => !selectedArchetype || arch.type === selectedArchetype)
              .map((arch) => (
              <div
                key={arch.id}
                className={`${arch.color} border-2 ${arch.borderColor} rounded-lg p-5 transition-all hover:shadow-md`}
              >
                <div className="flex items-start gap-4">
                  <span className="text-4xl flex-shrink-0">{arch.icon}</span>
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h4 className="font-bold text-slate-800 text-lg">{arch.id}: {arch.name}</h4>
                      <span className={`px-2 py-1 rounded text-xs font-semibold ${
                        arch.type === 'Core' ? 'bg-purple-200 text-purple-800' : 'bg-emerald-200 text-emerald-800'
                      }`}>
                        {arch.type}
                      </span>
                    </div>
                    <p className="text-sm text-slate-700 italic mb-3">"{arch.story}"</p>
                    <div className="mb-3">
                      <div className="text-xs font-semibold text-slate-600 mb-1">Common Variations:</div>
                      <div className="flex flex-wrap gap-2">
                        {arch.variations.map((v, idx) => (
                          <span key={idx} className="text-xs bg-white px-2 py-1 rounded border border-slate-200">
                            {v}
                          </span>
                        ))}
                      </div>
                    </div>
                    <div className="flex items-center gap-2 text-xs text-slate-600">
                      <span className="font-semibold">Tools from:</span>
                      {Object.keys(matrix)
                        .filter(k => k.endsWith(`-${arch.id}`))
                        .map(k => {
                          const topicId = parseInt(k.split('-')[0]);
                          const topic = topics.find(t => t.id === topicId);
                          if (!topic) return null;
                          const borderColor = topic.borderColor ? topic.borderColor.replace('300', '400') : 'border-slate-400';
                          return (
                            <span key={k} className={`${topic.color} px-2 py-1 rounded border ${borderColor} font-medium`}>
                              T{topicId}
                            </span>
                          );
                        })}
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
          
          <div className="mt-6 p-4 bg-purple-50 border-l-4 border-purple-400 rounded">
            <div className="flex items-start gap-2">
              <AlertCircle className="text-purple-600 mt-0.5" size={18} />
              <p className="text-sm text-slate-700">
                <strong>Purpose:</strong> Rapid question-type recognition in combat. First question when seeing a problem: "Which game is this?" not "Which chapter?"
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Bottom Summary */}
      <div className="mt-8 p-6 bg-gradient-to-r from-slate-800 to-slate-700 rounded-lg text-white">
        <h4 className="font-bold text-lg mb-3">üéØ Design Logic Summary</h4>
        <div className="grid grid-cols-3 gap-4 text-sm">
          <div>
            <div className="font-bold mb-1 text-blue-300">Warehouse Perspective</div>
            <div className="text-slate-300">Ensures systematic & complete learning (Knowledge Input)</div>
          </div>
          <div>
            <div className="font-bold mb-1 text-purple-300">Battlefield Perspective</div>
            <div className="text-slate-300">Ensures efficient & accurate problem-solving (Question Output)</div>
          </div>
          <div>
            <div className="font-bold mb-1 text-emerald-300">Matrix Perspective</div>
            <div className="text-slate-300">Reveals mapping relationships (Integration & Transfer)</div>
          </div>
        </div>
        <div className="mt-4 pt-4 border-t border-slate-600">
          <p className="text-xs text-slate-400 italic">
            Master Insight: Novices use "Warehouse only" (learn chapter ‚Üí do chapter). Experts switch to "Battlefield" (see question ‚Üí identify pattern). 
            Champions integrate "Matrix" (one tool ‚Üí multiple contexts).
          </p>
        </div>
      </div>
    </div>
  );
};

export default PhysicsKnowledgeMatrix;